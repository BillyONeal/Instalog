\section{Scanning Actions} \label{sec:scanning_actions}
This section defines the various ``scanning'' actions that Instalog will
support.  These actions will only gather more information about a system, but
will not attempt to modify anything.

\subsection{Running Processes (\texttt{:RunningProcesses})}
\begin{description}
\item[Rationale] \hfill \\
One obvious source of problems is the processes that are currently running on
the system.  As such, each of these processes shall be listed for analysis
purposes.  
\item[Invocation] \hfill \\
This can be invoked in a script by calling \verb|:RunningProcesses|.  This
action does not require any argument or additional input.
\item[Data Sources] \hfill \\
Memory.
\item[Log Format] \hfill \\
Instalog shall enumerate the full path to the main module of each running
process, and print it, unless the main module is one of the following:
\begin{itemize}
  \item \verb|%WINDIR%\System32\svchost|
  \item \verb|%WINDIR%\System32\svchost.exe|
  \item \verb|%WINDIR%\System32\rundll32.exe|
\end{itemize}
in which case the full command line used to launch the process in question shall
be enumerated instead.
\item[Output Description] \hfill \\
Both \var{path} and \var{arguments} shall be escaped according to the scheme
described in \ref{generalescape} where \verb|#| is the escape character.
\item[Whitelist Considerations] \hfill \\
The following process paths should be whitelisted:
\begin{itemize}
  \item \verb|%WINDIR%\System32\csrss.exe|
  \item \verb|%WINDIR%\System32\winlogon.exe|
  \item \verb|%WINDIR%\System32\services.exe|
  \item \verb|%WINDIR%\System32\lsass.exe|
  \item \verb|%WINDIR%\System32\smss.exe|
\end{itemize}
\item[Fix Considerations] \hfill \\
Two fix actions shall be available:
\begin{description}
\item[Kill] This action will kill the identified process.  This action shall
accept both the process path as well as arguments.  If multiple processes exist
that match the supplied path and arguments, all instances shall be killed. 
\item[Quarantine]  This action will kill and quarantine the identified
process.  This action shall accept both the process path as well as arguments. 
The \textbf{kill} action described above shall first be followed.  The process'
main module should then be moved into quarantine.
\end{description}
\end{description}

\subsection{Load Points Report (\texttt{:Loadpoints})} \label{hjtgeneral}
The information in the Load Points report must closely match the information
displayed by the original HJT tool. The format must closely match the syntax of
a similar predecessor, DDS, so that forum volunteers need not learn
significantly different syntax to that which they know. This format is
sparse and human readable. 

Generally speaking, the Load Points report shall attempt to list all relevant
loading points on a Windows machine, as well as user settings for the Internet
Explorer browser; such as home page, search provider, and title settings. The
report shall be heavily whitelisted. Items which are defaults on Windows shall
not be emitted, unless whitelisting has been disabled. Specific whitelisting
schemes are given per type of line shown in the Load Points report. Instalog shall
implement the Load Points report as defined in this section (\ref{hjtgeneral}).

Each line in the Load Points report is given a unique prefix, which is not shared
by other line types. This allows the line to be unambiguously understood by the
Instalog GUI, and other kinds of inspection tools.

For either Load Points section in the Instalog GUI, two checkboxes are available
if defined by the lines below: \textbf{Move} and \textbf{Fix} (in that
order).  Move, generally speaking, will generate script to quarantine a file
associated with an entry, and Fix will generate script to reset settings to a
default state, or delete loading points.

The Load Points machine report contains settings which affect the entire machine.

The Load Points user report is specific to a given user on the target machine.
There will be a separate such section for each user that is loaded into the
registry at the time Instalog is run (that is, loaded into \verb|HKEY_USERS|).

The first line of the user report indicates which SID and name the user has, and
is of the form:
\begin{verbatim}
Identity: "${username}" ${sid}
\end{verbatim}

The variable \var{username} refers to the display name of the user being
enumerated. It is escaped using the general escaping method defined in
\ref{generalescape}, using a right delimiter of \verb|"|, and an escape
character of \verb|\|. The \var{sid} is the security identifier associated with
that user. It follows a regular format, and therefore need not be escaped.

The PsuedoHJT report  can be invoked in a script by calling \verb|:PsuedoHJT|. 
This action does not require any argument or additional input.

\subsubsection{Root Registry Hives}
The log lines discussed in the remainder of \ref{hjtgeneral} are ``rooted'' at a
specific registry hive. Specifically, for the machine report, the root hive is
\verb|HKEY_LOCAL_MACHINE|. For a user report, this will be the root of the
user's registry, loaded under \verb|HKEY_USERS|. For instance,
\begin{verbatim}
HKEY_USERS\S-1-5-21-2812505617-3763003962-1231251036-1000
\end{verbatim}
That is, \verb|HKEY_USERS| followed by the user's SID.

The root hive of \verb|HKEY_LOCAL_MACHINE| or the user's hive shall be
the variable \var{RootHive} in the log lines below.

\subsubsection{Security Center}
\begin{description}
\item[Rationale] \hfill \\
The Security Center serves to drive the Security Center interface in Windows
added in Windows XP SP2. (Therefore there will be no output on operating
systems older than this)
\item[Data Sources] \hfill
The Windows Management Instrumentation's SecurityCenter and SecurityCenter2
namespaces.
\item[Log Format] \hfill \\
\verb|AV: [${CLSID}] ${Enabled}${Updated} ${Name}| \\
\verb|AS: [${CLSID}] ${Enabled}${Updated} ${Name}| \\
\verb|FW: [${CLSID}] ${Enabled} ${Name}|
\item[Output Description] \hfill \\
\var{CLSID} shall be the InstanceId of the given security product enumerated.
\var{Enabled} shall be the letter E or the letter D, for Enabled and Disabled,
respectively. \var{Updated} shall be the letter U for up to date, or O for out
of date. \var{Name} shall be the advertised name of the given security product.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Fix'' is the only valid option; generating a script which removes the given
item from the security center registrations list.
\end{description}

\subsubsection{Default Page URL}
\begin{description}
\item[Rationale] \hfill \\
The User Default Page URL is the location(s) of pages opened when a user creates
a new Microsoft Internet Explorer window, or starts the browser for the first
time. 
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\Main]
"Default_Page_URL"="${url}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
DefaultPageUrl: ${url}
DefaultPageUrl64: ${url}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} is escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
\input{snippets/iewhitelist.tex}
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It generates script setting the value
``\verb|Default_Page_URL|'' to ``\verb|http://google.com/|''.
\end{description}

\subsubsection{Default Search URL}
\begin{description}
\item[Rationale]  \hfill \\ The default search URL is used to redirect the user
to a specific web search site if they type an invalid URL.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\Main]
"Default_Search_URL"="${url}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
DefaultSearchUrl: ${url}
DefaultSearchUrl64: ${url}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} is escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
\input{snippets/iewhitelist.tex}
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It generates script setting the value
``\verb|Default_Search_URL|'' to ``\verb|http://google.com/|''.
\end{description}

\subsubsection{Local Page URL}
\begin{description}
\item[Rationale]  \hfill \\ The local URL is shown as the "blank" page in
Internet Explorer.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\Main]
"Local Page"="${url}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
LocalPage: ${url}
LocalPage64: ${url}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} is escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
On x86 versions of Windows, the default value of
\var{url} is \verb|%WINDIR%\System32\Blank.htm|, which shall not be displayed.
On x64 versions of Windows, the default value of \var{url} for 64 bit
registry views is \verb|%WINDIR%\System32\Blank.htm|, and the default value of
\var{url} for 32 bit registry views is
\verb|%WINDIR%\SysWow64\Blank.htm|, neither of which shall be displayed.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It generates script resetting the default
value for the machine type which generated the log.
\end{description}

\subsubsection{Start Page URL}
\begin{description}
\item[Rationale]  \hfill \\ This setting corresponds to Internet Explorer's home
page.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\Main]
"Start Page"="${url}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
StartPage: ${url}
StartPage64: ${url}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} is escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
\input{snippets/iewhitelist.tex}
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It generates script setting the start page to
Google.
\end{description}

\subsubsection{Search Page URL}
\begin{description}
\item[Rationale] \hfill \\ This is a legacy setting which specifies the URL to
open if the user selects Start $\rightarrow$ Find $\rightarrow$ On The Internet.
(It is enumerated primarily because other tools do)
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\Main]
"Search Page"="${url}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
SearchPage: ${url}
SearchPage64: ${url}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} is escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
\input{snippets/iewhitelist.tex}
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It generates script setting the value
``\verb|Search Page|'' to Google.
\end{description}

\subsubsection{Search Bar}
\begin{description}
\item[Rationale]  \hfill \\ It is suspected that this value contains information
about the search bar used in Internet Explorer versions 7 and 8. (It is
enumerated primarily because other tools do)
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\Main]
"Search Bar"="${url}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
SearchBar: ${url}
SearchBar64: ${url}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} is escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
\input{snippets/iewhitelist.tex}
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which resets this
value to the default setting.
\end{description}

\subsubsection{Search Migrated Default URL}
\begin{description}
\item[Rationale]  \hfill \\ This value contains migrated search URL settings.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\Main]
"SearchMigratedDefaultUrl"="${url}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
SearchMigratedDefaultUrl: ${url}
SearchMigratedDefaultUrl64: ${url}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} is escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
\input{snippets/iewhitelist.tex}
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the value.
\end{description}

\subsubsection{Security Risk URL}
\begin{description}
\item[Rationale]  \hfill \\ This value contains the URL used to warn users about
potential security faults with a particular website.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\Main]
"Security Risk Page"="${url}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
SecurityPage: ${url}
SecurityPage64: ${url}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} is escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
The default setting for both variables is ``\verb|about:SecurityRisk|''. This
line will not be generated if that default setting is set.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which resets the
``\verb|Security Risk Page|'' value to the default.
\end{description}

\subsubsection{Internet Explorer Window Title}
\begin{description}
\item[Rationale]  \hfill \\ This value is used to allow OEMs to customize their
versions of Internet Explorer, such as making the title say ``Microsoft Internet
Explorer provided by Timer Warner Cable''.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\Main]
"Window Title"="${title}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
WindowTitle: ${title}
WindowTitle64: ${title}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{title} is escaped using the general
escaping method defined in \ref{generalescape}, using an escape character of
the hash mark (\verb|#|).
\item[Whitelist Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the
``\verb|WindowTitle|'' value.
\end{description}

\subsubsection{Search URL}
\begin{description}
\item[Rationale] \hfill \\
The URL to use when the user types something into the address bar that isn't
an address, for example: \verb|http://google.com/search?q=%s| where \verb|%s|
is filled by the user's query.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\Main]
"SearchURL"="${url}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
SearchUrl: ${url}
SearchUrl64: ${url}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} is escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the value
in question.
\end{description}

\subsubsection{Search Assistant}
\begin{description}
\item[Rationale] \hfill \\
This is the value used to display a search engine in the search page when the
user selects ``Search'' from Internet Explorer's toolbar.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\Search]
"SearchAssistant"="${url}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
SearchAssistant: ${url}
SearchAssistant64: ${url}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} is escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the value
in question.
\end{description}

\subsubsection{Customize Search}
\begin{description}
\item[Rationale] \hfill \\
Unknown, but HijackThis and DDS enumerate it.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\Search]
"CustomizeSearch"="${url}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
CustomizeSearch: ${url}
CustomizeSearch64: ${url}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} is escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the value
in question.
\end{description}

\subsubsection{URL Search Hooks}
\begin{description}
\item[Rationale] \hfill \\
URL Search Hooks are used by Internet Explorer in the event the user types in
something that is not an address in order to attempt to resolve a reasonable web
address.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\
    Internet Explorer\URLSearchHooks]
"${CLSID}"="${AlternateName}"
[HKEY_CLASSES_ROOT\CLSID\${CLSID}]
@="${Name}"
[HKEY_CLASSES_ROOT\CLSID\${CLSID}\InprocServer32]
@="${File}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|UrlSearchHook: ${SelectedName}: ${CLSID}=${File}| \\
\verb|UrlSearchHook64: ${SelectedName}: ${CLSID}=${File}|
\item[Output Description] \hfill \\
\var{SelectedName} is either \var{Name}, \var{AlternateName}, or the string
``\verb|N/A|'', in order. (That is, failing to the next if the given name is
empty) \var{SelectedName} is escaped using the default escaping method defined
in \ref{generalescape}, using an escape character of hash (\verb|#|) and a right
delimiter of colon (\verb|:|). \var{CLSID} shall also be escaped, using the
same escape character but a right delimiter of equals (\verb|=|). File shall be
passed through the resolution process defined in \ref{stdfile}.
\item[Whitelist Considerations] \hfill \\
The default CLSID is
\vspace{-\baselineskip}
\begin{verbatim}
{CFBFAE00-17A6-11D0-99CB-00C04FD64497}
\end{verbatim}
the default file is
\vspace{-\baselineskip}
\begin{verbatim}
${WINDIR}\System32\ieframe.dll
\end{verbatim}
the default name
is ``Microsoft Url Search Hook'', and the default alternate name is the empty
string.
This default entry is the legitimate system default and shall be whitelisted.
\item[Fix Considerations] \hfill \\
Both ``Move'' and ``Fix'' are valid. ``Move'' shall generate a script which
quarantines the indicated file (if it exists). ``Fix'' shall generate a fix
removing the URLSearchHook from the registry.
\end{description}

\subsubsection{Shell}
\begin{description}
\item[Rationale] \hfill \\
The shell is responsible for drawing the user's taskbar, start menu, icons, etc.
Sometimes users legitimately replace the shell with alternates such as xplorer2.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows NT\CurrentVersion\Winlogon]
"Shell"="${Shell}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|Shell: ${Shell}|
\item[Output Description] \hfill \\
The variable \var{Shell} is shown using the file display method defined in
section \ref{stdfile}.
\item[Whitelist Considerations] \hfill \\
The default value if \var{Shell}, ``\verb|explorer.exe|'', shall be whitelisted.
\item[Fix Considerations] \hfill \\
The option ``Move'' shall generate a script quarantining the file in question.
The option ``Fix'' shall restore the default registry value.
\end{description}

\subsubsection{Userinit}
\begin{description}
\item[Rationale] \hfill \\
Userinit performs user initialization procedures for Windows, to get a user's
session ready for use. If it is damaged, or disabled, users' attempts to log in
will immediately cause them to log out.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows NT\CurrentVersion\Winlogon]
"Userinit"="${Userinit}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|Userinit: ${Userinit}|
\item[Output Description] \hfill \\
The variable \var{Userinit} is shown using the file display method defined in
section \ref{stdfile}.
\item[Whitelist Considerations] \hfill \\
The default value if \var{Userinit}, ``\verb|userinit.exe|'', shall be whitelisted.
\item[Fix Considerations] \hfill \\
The option ``Move'' shall generate a script quarantining the file in question.
The option ``Fix'' shall restore the default registry value.
\end{description}

\subsubsection{UI Host}
\begin{description}
\item[Rationale] \hfill \\
The UI Host is used by Windows to help display the logon screen.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows NT\CurrentVersion\Winlogon]
"UIHost"="${UIHost}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|UIHost: ${UIHost}|
\item[Output Description] \hfill \\
The variable \var{UIHost} is shown using the file display method defined in
section \ref{stdfile}.
\item[Whitelist Considerations] \hfill \\
The default value if \var{UIHost}, ``\verb|logonui.exe|'', shall be whitelisted.
\item[Fix Considerations] \hfill \\
The option ``Move'' shall generate a script quarantining the file in question.
The option ``Fix'' shall restore the default registry value.
\end{description}

\subsubsection{Task Manager}
\begin{description}
\item[Rationale] \hfill \\
The task manager is the interface Windows provides to terminate processes for a
user. The registry value in question here changes what Windows interprets as the
task manager for the purposes of the Control+Alt+Delete key sequence.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows NT\CurrentVersion\Winlogon]
"TaskMan"="${TaskMan}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|TaskMan: ${TaskMan}|
\item[Output Description] \hfill \\
The variable \var{TaskMan} is shown using the file display method defined in
section \ref{stdfile}.
\item[Whitelist Considerations] \hfill \\
The default value if \var{TaskMan}, ``\verb|taskmgr.exe|'', shall be whitelisted.
\item[Fix Considerations] \hfill \\
The option ``Move'' shall generate a script quarantining the file in question.
The option ``Fix'' shall restore the default registry value.
\end{description}

\subsubsection{System File Checking Disable}
\begin{description}
\item[Rationale] \hfill \\
This registry value disables Windows File Protection.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows NT\CurrentVersion\Winlogon]
"SFCDisable"=dword:${SFCDisable}
\end{verbatim}
\item[Log Format] \hfill \\
\verb|SFC: Enabled| \\
\verb|SFC: Disabled|
\item[Output Description] \hfill \\
The variable \var{SFCDisable} is a number; if it is zero, then the ``Enabled''
line is printed. If it is nonzero, then the ``Disabled'' line is printed. If it
does not exist, then nothing is printed.
\item[Whitelist Considerations] \hfill \\
Not applicable. (This entry does not exist by default)
\item[Fix Considerations] \hfill \\
The option ``Fix'' shall delete the registry value.
\end{description}

\subsubsection{Browser Helper Objects}
\begin{description}
\item[Rationale] \hfill \\
Browser Helper Objects are one of Internet Explorer's extension mechanisms.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
;Either 32 or 64 bit registry view
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\Explorer\
    Browser Helper Objects\${CLSID}]
@="${AlternateName}"
[HKEY_CLASSES_ROOT\CLSID\${CLSID}]
@="${Name}"
[HKEY_CLASSES_ROOT\CLSID\${CLSID}\InProcServer32]
@="${File}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
BHO: ${GeneratedName}: ${CLSID} ${File}
BHO64: ${GeneratedName}: ${CLSID} ${File}
\end{verbatim}
\item[Output Description] \hfill \\
\var{GeneratedName} is \var{Name}, \var{AlternateName}, or ``\verb|No Name|'',
whichever has content first, escaped using the general escaping method defined
in \ref{generalescape}, using an escape character of hash (\verb|#|) and a right
delimiter of colon (\verb|:|). \var{CLSID} is escaped using the default escaping
function as well, using an escape character of hash (\verb|#|), and a right
delimiter of space (\verb| |). \var{File} is displayed using the standard file
display format defined in \ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Move'' shall generate a fix which moves \var{File}. ``Fix'' shall generate a
fix which removes the specific browser helper object key, and its associated
subkey of \verb|HKCR\CLSID|.
\end{description}

\subsubsection{Toolbars}
\begin{description}
\item[Rationale] \hfill \\
Toolbars are one of Internet Explorer's extension mechanisms.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
;Either 32 or 64 bit registry view; one of the following is a toolbar root
[${RootHive}\Software\Microsoft\Internet Explorer\Toolbar]
"${CLSID}"="${AlternateName}"
[${RootHive}\Software\Microsoft\Internet Explorer\Toolbar\Webbrowser]
"${CLSID}"="${AlternateName}"

[HKEY_CLASSES_ROOT\CLSID\${CLSID}]
@="${Name}"
[HKEY_CLASSES_ROOT\CLSID\${CLSID}\InProcServer32]
@="${File}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
TB: ${GeneratedName}: ${CLSID} ${File}
TB64: ${GeneratedName}: ${CLSID} ${File}
\end{verbatim}
\item[Output Description] \hfill \\
\var{GeneratedName} is \var{Name}, \var{AlternateName}, or ``\verb|No Name|'',
whichever has content first, escaped using the general escaping method defined
in \ref{generalescape}, using an escape character of hash (\verb|#|) and a right
delimiter of colon (\verb|:|). \var{CLSID} is escaped using the default escaping
function as well, using an escape character of hash (\verb|#|), and a right
delimiter of space (\verb| |). \var{File} is displayed using the standard file
display format defined in \ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Move'' shall generate a fix which moves \var{File}. ``Fix'' shall generate a
fix which removes the specific toolbar value, and its associated subkey of
\verb|HKCR\CLSID|.
\end{description}

\subsubsection{Explorer Bars}
\begin{description}
\item[Rationale] \hfill \\
Explorer Bars are Windows Explorer's equivalent of toolbars.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
;Either 32 or 64 bit registry view
[${RootHive}\Software\Microsoft\Internet Explorer\Explorer Bars]
"${CLSID}"="${AlternateName}"

[HKEY_CLASSES_ROOT\CLSID\${CLSID}]
@="${Name}"
[HKEY_CLASSES_ROOT\CLSID\${CLSID}\InProcServer32]
@="${File}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
EB: ${GeneratedName}: ${CLSID} ${File}
EB64: ${GeneratedName}: ${CLSID} ${File}
\end{verbatim}
\item[Output Description] \hfill \\
\var{GeneratedName} is \var{Name}, \var{AlternateName}, or ``\verb|No Name|'',
whichever has content first, escaped using the general escaping method defined
in \ref{generalescape}, using an escape character of hash (\verb|#|) and a right
delimiter of colon (\verb|:|). \var{CLSID} is escaped using the default escaping
function as well, using an escape character of hash (\verb|#|), and a right
delimiter of space (\verb| |). \var{File} is displayed using the standard file
display format defined in \ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Move'' shall generate a fix which moves \var{File}. ``Fix'' shall generate a
fix which removes the specific explorer bar value, and its associated subkey of
\verb|HKCR\CLSID|.
\end{description}

\subsubsection{Registry Autostarts}
\begin{description}
\item[Rationale] \hfill \\
These entries are run by Windows Explorer when a user logs in. On 64 bit
machines, both the 32 bit and 64 bit versions of these keys are checked and
started.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\Run]
"${Name}"="${File}"
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\RunOnce]
"${Name}"="${File}"
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\RunServices]
"${Name}"="${File}"
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce]
"${Name}"="${File}"
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\
    Policies\Explorer\Run]
"${Name}"="${File}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
Run: [${Name}] ${File}
Run64: [${Name}] ${File}
RunOnce: [${Name}] ${File}
RunOnce64: [${Name}] ${File}
RunServices: [${Name}] ${File}
RunServices64: [${Name}] ${File}
RunServicesOnce: [${Name}] ${File}
RunServicesOnce64: [${Name}] ${File}
ExplorerRun: [${Name}] ${File}
ExplorerRun64: [${Name}] ${File}
\end{verbatim}
\item[Output Description] \hfill \\
\var{Name} is escaped using the default escaping method (see section
\ref{generalescape}), using an escape character of hash (\verb|#|), and a right
delimiter of right square bracket (\verb|]|). \var{File} is displayed with the
general file display method (\ref{stdfile}).

The versions of the log lines with prefixes ending in ``64'' are those which are
taken from the 64 bit registry view. The remainder of the prefix corresponds to
the last path component of the registry key from which the data is taken.
\item[Whitelisting Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
``Move'' shall generate a fix which quarantines the indicated file. ``Fix''
shall generate a fix which erases the indicated value.
\end{description}

\subsubsection{Policies}
\begin{description}
\item[Rationale] \hfill \\
The Policies are designed to allow a system administrator restrict operation of
a given machine; either to prevent an employee from doing something, or to allow
secure and safe operation of computers in a public environment such as kiosks.
However, malware can use these values for nefarious purposes, such as stopping
security software.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\
    Policies\Explorer]
"${Name}"="${Value}"
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\
    Policies\System]
"${Name}"="${Value}"
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\
    Policies\Explorer\DisallowRun]
"${Name}"="${Value}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
PoliciesExplorer: [${Name}] ${Value}
PoliciesExplorer64: [${Name}] ${Value}
PoliciesSystem: [${Name}] ${Value}
PoliciesSystem64: [${Name}] ${Value}
PoliciesDisallowRun: [${Name}] ${Value}
PoliciesDisallowRun64: [${Name}] ${Value}
\end{verbatim}
\item[Output Description] \hfill \\
\var{Name} shall be escaped using the general escaping method defined in
\ref{generalescape}, using an escape character of hash (\verb|#|), and a right
delimiter of right square bracket (\verb|]|). \var{Value} shall also be escaped
using the general method and the hash (\verb|#|) escape character.
\item[Whitelisting Considerations] \hfill \\
None.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which removes the associated policy value.
\end{description}

\subsubsection{Internet Explorer Menu Options}
\begin{description}
\item[Rationale] \hfill \\
These are menu items shown in Internet Explorer. Malware will sometimes put
traps here for a user to click on after everything else has been removed (e.g.
replacing the normal Windows Update option with one that goes to a malicious
copy of Windows Update\ldots)
\item[Data Sources] \hfill
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Explorer\MenuExt\${Name}]
@="${Command}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|IeMenu: [${Name}] ${Command}| \\
\verb|IeMenu64: [${Name}] ${Command}|
\item[Output Description] \hfill \\
\var{Name} is escaped using the default escaping convention defined in
\ref{generalescape} with an escape character of \verb|#| and a right delimiter
of \verb|]|. \var{Command} is displayed using the default file format as defined
in \ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
None.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which removes the associated key. ``Move'' shall
generate a script which moves the file associated with \var{Command}.
\end{description}

\subsubsection{Internet Explorer Script Extensions}
\begin{description}
\item[Rationale] \hfill \\
These are script extensions loaded by Internet Explorer, and can override
behavior of the browser.
\item[Data Sources] \hfill
\begin{verbatim}
; One of the following:
[${RootHive}\Software\Microsoft\Internet Explorer\Extensions\${Name}]
"Exec"="${Command}"
[${RootHive}\Software\Microsoft\Internet Explorer\Extensions\${Name}]
"Script"="${Command}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|IeScript: [${Name}] ${Command}| \\
\verb|IeScript64: [${Name}] ${Command}|
\item[Output Description] \hfill \\
\var{Name} is escaped using the default escaping convention defined in
\ref{generalescape} with an escape character of \verb|#| and a right delimiter
of \verb|]|. \var{Command} is displayed using the default file format as defined
in \ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
None.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which removes the associated key. ``Move'' shall
generate a script
\end{description}

\subsubsection{Internet Explorer COM Extensions}
\begin{description}
\item[Rationale] \hfill \\
These are COM extensions loaded by Internet Explorer, and can override
behavior of the browser. These are (generally speaking) more powerful than the
script extensions because they are native code.
\item[Data Sources] \hfill
\begin{verbatim}
; One of the following:
[${RootHive}\Software\Microsoft\Internet Explorer\Extensions\${Name}]
"clsidextension"="${Clsid}"
[${RootHive}\Software\Microsoft\Internet Explorer\Extensions\${Name}]
"bandclsid"="${Clsid}"
; And the following:
[HKEY_CLASSES_ROOT\CLSID\${Clsid}\InProcServer32]
@="${File}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|IeCom: [${Name} ${Clsid}] ${File}| \\
\verb|IeCom64: [${Name} ${Clsid}] ${File}|
\item[Output Description] \hfill \\
\var{Name} is escaped using the default escaping convention defined in
\ref{generalescape} with an escape character of \verb|#| and a right delimiter
of a space character. \var{Clsid} is also escaped using the default escape
function, using an escape character of \verb|#| and a right delimiter of \verb|]|.
\var{File} is displayed using the default file format as defined in
\ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
None.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which removes the key associated with
\var{Name}, as well as the root key associated with \var{Clsid}.
``Move'' shall generate a script which quarantines the file in question.
\end{description}

\subsubsection{Internet Explorer Trusted Zone}
\begin{description}
\item[Rationale] \hfill \\
The trusted zone contains domains which receive preferential treatment (lower
security settings) by Internet Explorer.
\item[Data Sources] \hfill \\
Internet Explorer's ``\verb|IInternetSecurityManager|'' interface.
\item[Log Format] \hfill \\
\verb|TrustedZone: ${Domain}|
\item[Output Description] \hfill \\
\var{Domain} is escaped using the default escaping function defined in
\ref{generalescape}.
\item[Whitelisting Considerations] \hfill \\
None.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which removes the item from the trusted zone.
\end{description}

\subsubsection{Machine Only Line Types}
The following lines are displayed in machine PsuedoHJT reports only.

\subsubsection{Downloaded Program Files}
\begin{description}
\item[Rationale] \hfill \\
DPFs are ActiveX controls loaded into Internet Explorer by any website.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Code Store Database\Distribution Units\${CLSID}]
\end{verbatim}
\item[Log Format] \hfill \\
\verb|DPF: ${CLSID}|
\item[Output Description] \hfill \\
\var{CLSID} is escaped using the default escaping function defined in \ref{generalescape}.
\item[Whitelisting Considerations] \hfill \\
None.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which removes the item from the registry.
\end{description}

\subsubsection{Winsock Layered Service Providers and Namespace Providers}
\label{sec:lsp}
\begin{description}
\item[Rationale] \hfill \\
There are two types of Winsock service providers: Layered Service Providers
(LSPs) and Namespace Service Providers (NSPs).

Layered service providers are an integral part of the Windows IP stack. When a
packet is sent through the network, each LSP is a ``layer'' which gets to
inspect or modify the packet before it is sent to the network. This is used
legitimately for applications like firewalls, but also by malware to redirect
users and cause other kinds of damage.

Namespace providers provide a similar service at a different level of the
Winsock stack. Specifically, MSDN says:
\begin{quote}
A namespace provider implements an interface mapping between the Winsock
namespace SPI and the native programmatic interface of an existing name
service such as DNS, X.500, or NetWare Directory Services (NDS).
\end{quote}
(See \url{http://msdn.microsoft.com/en-us/library/ms739923.aspx})

What's more, these providers are laid out in a very specific format. If a binary
in the chain is missing or corrupted, such as would happen by deleting a piece
of malware using this technique, the user's Internet access would be broken
until the chain could be restored.
\item[Data Sources] \hfill
\begin{verbatim}
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Winsock2
    \Parameters]
"Current_Protocol_Catalog"="${ProtocolCatalog}"
"Current_NameSpace_Catalog"="${NamespaceCatalog}"

;LSP Information
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Winsock2
    \Parameters\${ProtocolCatalog}]
"Num_Catalog_Entries"=dword:${NumberOfProtocolEntries}
"Num_Catalog_Entries64"=dword:${NumberOfx64ProtocolEntries}
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Winsock2
    \Parameters\${ProtocolCatalog}\CatalogEntries\${ProtocolNumber}]
"PackedCatalogItem"="${ProtocolBlob}"
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Winsock2
    \Parameters\${ProtocolCatalog}\CatalogEntries64\${ProtocolNumber}]
"PackedCatalogItem"="${ProtocolBlob}"

;NSP Information
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Winsock2
    \Parameters\${NamespaceCatalog}]
"Num_Catalog_Entries"=dword:${NumberOfCatalogEntries}
"Num_Catalog_Entries64"=dword:${NumberOfx64CatalogEntries}
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Winsock2
    \Parameters\${NamespaceCatalog}\CatalogEntries\${NamespaceNumber}]
"LibraryPath"="${NspPath}"
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Winsock2
    \Parameters\${NamespaceCatalog}\CatalogEntries64\${NamespaceNumber}]
"LibraryPath"="${NspPath}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|LSP: ${File}| \\
\verb|LSP64: ${File}| \\
\verb|LSP: Chain Broken| \\
\verb|LSP64: Chain Broken| \\
\verb|NSP: ${NspPath}| \\
\verb|NSP64: ${NspPath}| \\
\verb|NSP: Chain Broken| \\
\verb|NSP64: Chain Broken|
\item[Output Description] \hfill \\
For LSPs, the file is determined by unpacking the ``PackedCatalogEntry'' binary
blob, which (fortunately) begins with a null terminated string containing the
full path to the binary providing the layer.

For NSPs, things are simpler; the registry value indicated provides a direct
path to the file in question.

For both types, the catalog location in the registry is taken from the root
Winsock2 parameters key, and for each number between 1 and the value of the
number of entries indicated in the given catalog, and enumerates a file. Then,
duplicate file names are removed. Finally, files are displayed using the
standard file display format defined in \ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
The following files are whitelisted on all versions of Windows Instalog
supports:
\begin{enumerate}
    \item \verb|%SystemRoot%\System32\rsvpsp.dll|
    \item \verb|%SystemRoot%\System32\winrnr.dll|
    \item \verb|%SystemRoot%\System32\mswsock.dll|
    \item \verb|%SystemRoot%\System32\msafd.dll|
\end{enumerate}

The following files are whitelisted on Windows Vista and later:
\begin{enumerate}
    \item \verb|%SystemRoot%\System32\NLAapi.dll|
    \item \verb|%SystemRoot%\System32\napinsp.dll|
    \item \verb|%SystemRoot%\System32\pnrpnsp.dll|
\end{enumerate}

Note that these entries shall be whitelisted if and only if they exist. If they
do not exist then the chain may be broken, and this needs to be visible in the
report in some way.
\item[Fix Considerations] \hfill \\
For the log lines with files, ``Move'' shall generate a script which quarantines
the offending file, and repairs the chain in question.
For the log lines without files, ``Fix'' shall generate a script which repairs
the chain in question.
\end{description}

\subsubsection{DNS Servers}
\begin{description}
\item[Rationale] \hfill \\
The DNS servers are used to resolve a domain name to a given IP address. Malware
can use this to redirect users to malicious web servers.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters]
"NameServer"="${NameServer}"
"DHCPNameServer"="${DHCPNameServer}"

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters
    \Interfaces\${CLSID}]
"NameServer"="${NameServer}"
"DHCPNameServer"="${DHCPNameServer}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|TcpNameserver: ${NameServer}| \\
\verb|TcpDhcpNameserver: ${DHCPNameServer}| \\
\verb|TcpNameserver: [${CLSID}] ${NameServer}| \\
\verb|TcpDhcpNameserver: [${CLSID}] ${DHCPNameServer}| \\
\item[Output Description] \hfill \\
\var{CLSID} is escaped using the default escaping function defined in
\ref{generalescape}, using an escape character of hash (\verb|#|) and a right
delimiter of right square bracket (\verb|]|).
\item[Whitelisting Considerations] \hfill \\
None.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which deletes the associated registry value.
\end{description}

\subsubsection{Spoofed DNS Check} \label{sec:hjt_dnscheck}
\begin{description}
\item[Rationale] \hfill \\
Although this hasn't been seen much in the field yet, one possible vulnerability
is one where an attacker changes the DNS server on a machine from a safe server
to a malicious one which will send users to lookalike websites designed to make
the attacker money though ads, phishing, or other means.  In an attempt to
detect this, Instalog shall validate the DNS response given from the default
server with a DNS server that is known to be safe.  If there is a discrepancy,
it shall be reported.  This check shall be run for many common sites.

Note that the DNS server on a user's machine can be set from any number of
locations.  An interesting attack could be if the users' home router itself is
attacked such that it gives all machines connected to it a malicious DNS server.
\item[Data Sources] \hfill \\
Instalog shall query the machine's default DNS server for common websites
(referred to as \var{Url}).  Instalog will record the IP address response(s) it
receives in the list \var{ResponseIp}.  For each of the
\var{ResponseIp} IP addresses in \var{ResponseIp}, Instalog shall perform a DNS
query against a safe DNS server (such as Google's DNS servers or OpenDNS's DNS
Servers) to get the url associated with that IP (referred to as \var{ResponseIp}).
If the response url does not match the expected response, then the result shall be
logged according to the format explained in the \textbf{Log Format} section.

Below is a list of \var{Url}'s to query along with the expected reverse lookup
url.

\begin{tabular}{l | l}
\textbf{URL} & \textbf{Expected URL Response} \\ \hline 
\verb|google.com| & \verb|*.1e100.net| \\ \hline
\verb|facebook.com| & \verb|*.facebook.com| \\ \hline
\verb|youtube.com| & \verb|*.1e100.net| \\ \hline
\verb|yahoo.com| & \verb|*.yahoo.com| \\ \hline
\verb|live.com| & \verb|central-hotmail.us| \\ \hline
\verb|twitter.com| & \verb|*.twitter.com| \\ \hline
\verb|wellsfargo.com| & \verb|*.wellsfargo.com| \\ \hline
\verb|citibank.com| & \verb|citibank.com| \\ \hline
\verb|td.com| & \verb|td.com|
\end{tabular}

Unfortunately, this reverse DNS lookup method does not work for many popular
sites including most domains run by Microsoft as well as domains run by most
popular banking institutions.  If for some reason a response is not available,
\var{ResponseUrl} shall be set to ``no response'' and shall be logged according
to the \textbf{Log Format} section.
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
SpoofedDNS: ${Url}->${ResponseUrl} (${ResponseIp})
\end{verbatim}
\item[Output Description] \hfill \\
\var{Url} and \var{ResponseUrl} shall be escaped according to the
scheme defined in \ref{urlescape}.
\item[Whitelisting Considerations] \hfill \\
As described in the \textbf{Data Sources} section, each line shall only be
emitted to the log if the urls do not match.
\item[Fix Considerations] \hfill \\
None.
\end{description}

\subsubsection{Protocols}
\begin{description}
\item[Rationale] \hfill \\
The protocols registrations tell Internet Explorer how to handle particular
protocols, such as HTTP or FTP.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
;One of the following:
[HKEY_CLASSES_ROOT\PROTOCOLS\Filter\${Item}]
"CLSID"="${CLSID}"
[HKEY_CLASSES_ROOT\PROTOCOLS\Handler\${Item}]
"CLSID"="${CLSID}"
[HKEY_CLASSES_ROOT\PROTOCOLS\Name-Space Handler\${Item}]
"CLSID"="${CLSID}"

;And:
[HKEY_CLASSES_ROOT\CLSID\${CLSID}\InProcServer32]
@="${File}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|IeFilter: [${Item}->${CLSID}] ${File}| \\
\verb|IeHandler: [${Item}->${CLSID}] ${File}| \\
\verb|IeNamespace: [${Item}->${CLSID}] ${File}|
\item[Output Description] \hfill \\
\var{Item} is escaped using the default escaping function defined in
\ref{generalescape}, using an escape character of hash (\verb|#|), and a right
delimiter if dash (\verb|-|) \var{CLSID} is escaped using the default escaping
function defined in \ref{generalescape}, using an escape character of hash
(\verb|#|) and a right delimiter of right square bracket (\verb|]|).
\var{File} is displayed using the method defined in section \ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which deletes the registry key mentioned as
\var{Item}, as well as the associated CLSID key defined by \var{CLSID}. ``Move''
shall generate a script quarantining the file in question.
\end{description}

\subsubsection{Winlogon Notify}
\begin{description}
\item[Rationale] \hfill \\
Winlogin notify allows applications to customize the log in screen.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\
    Winlogon\Notify\${Name}]
"DllName"="${File}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|Notify: [${Name}] ${File}|
\item[Output Description] \hfill \\
\var{Name} shall be escaped using the default escaping function defined in
\ref{generalescape}, using an escape character of hash (\verb|#|), and a right
delimiter of right square bracket (\verb|]|). \var{File} shall be displayed
using the default file format defined in \ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which deletes the registry key mentioned as
\var{Name}. ``Move'' shall generate a script which quarantines the associated
file.
\end{description}

\subsubsection{Application Initialization DLLs}
\begin{description}
\item[Rationale] \hfill \\
Application Initialization DLLs are DLLs loaded into every process that loads
user32.dll, which is usually loaded. This allows malware to inject code into all
processes on the system.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\
    Winlogon]
"Appinit_Dlls"="${Dlls}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|AppinitDll: ${File}| \\
\verb|AppinitDll64: ${File}|
\item[Output Description] \hfill \\
\var{Dlls} is a comma or space delimited list of DLLs. Each individual DLL shall
be turned into a separate line in the log, using the default file display format
defined in \ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which removes the single indicated DLL from the
registry. ``Move'' shall generate a script which quarantines the indicated DLL.
\end{description}

\subsubsection{Shell Object Service Delay Load}
\begin{description}
\item[Rationale] \hfill \\
Shell Object Service Delay Load DLLs are loaded by the shell. They are loaded
even in safe mode.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\
    ShellObjectServiceDelayLoad]
"${AlternateName}"="${CLSID}"
[HKEY_CLASSES_ROOT\CLSID\${CLSID}]
@="${Name}"
[HKEY_CLASSES_ROOT\CLSID\${CLSID}\InProcServer32]
@="${File}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|Ssodl: [${GeneratedName}->${CLSID}] ${File}| \\
\verb|Ssodl64: [${GeneratedName}->${CLSID}] ${File}|
\item[Output Description] \hfill \\
\var{GeneratedName} shall consist of \var{Name} if its
contents are not blank, followed by \var{AlternateName} if its contents are
not blank, followed by the empty string. \var{File} uses the standard file
output format defined in \ref{stdfile}. \var{GeneratedName} and \var{CLSID} use
the standard escaping format defined in \ref{generalescape}, using an escape
character of hash (\verb|#|) and right delimiters of dash (\verb|-|) and
right square bracket (\verb|]|), respectively.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which removes the value under the
ShellObjectServiceDelayLoad registry key, and the associated key under
HKCR\textbackslash{}CLSID.
``Move'' shall generate a script which quarantines the indicated DLL.
\end{description}

\subsubsection{Shared Task Scheduler}
\begin{description}
\item[Rationale] \hfill \\
The Shared Task Scheduler DLLs modify how the task scheduler operates.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\
    Explorer\SharedTaskScheduler]
"${AlternateName}"="${CLSID}"
[HKEY_CLASSES_ROOT\CLSID\${CLSID}]
@="${Name}"
[HKEY_CLASSES_ROOT\CLSID\${CLSID}\InProcServer32]
@="${File}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|Sts: [${GeneratedName}->${CLSID}] ${File}| \\
\verb|Sts64: [${GeneratedName}->${CLSID}] ${File}|
\item[Output Description] \hfill \\
\var{GeneratedName} shall consist of \var{Name} if its
contents are not blank, followed by \var{AlternateName} if its contents are
not blank, followed by the empty string. \var{File} uses the standard file
output format defined in \ref{stdfile}. \var{GeneratedName} and \var{CLSID} use
the standard escaping format defined in \ref{generalescape}, using an escape
character of hash (\verb|#|) and right delimiters of dash (\verb|-|) and
right square bracket (\verb|]|), respectively.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which removes the value under the
Shared Task Scheduler registry key, and the associated key under
HKCR\textbackslash{}CLSID.
``Move'' shall generate a script which quarantines the indicated DLL.
\end{description}

\subsubsection{Shell Execute Hooks}
\begin{description}
\item[Rationale] \hfill \\
Shell Execute Hooks provide extensions to Windows' \verb|ShellExecute| function.
Applications can override these in order to make actions on specific files or
similar perform some custom functionality. Malware, however, can use it as a
loading point.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\
    Explorer\ShellExecuteHooks]
"${CLSID}"="${AlternateName}"
[HKEY_CLASSES_ROOT\CLSID\${CLSID}]
@="${Name}"
[HKEY_CLASSES_ROOT\CLSID\${CLSID}\InProcServer32]
@="${File}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|Seh: [${GeneratedName}->${CLSID}] ${File}| \\
\verb|Seh64: [${GeneratedName}->${CLSID}] ${File}|
\item[Output Description] \hfill \\
\var{GeneratedName} shall consist of \var{Name} if its
contents are not blank, followed by \var{AlternateName} if its contents are
not blank, followed by the empty string. \var{File} uses the standard file
output format defined in \ref{stdfile}. \var{GeneratedName} and \var{CLSID} use
the standard escaping format defined in \ref{generalescape}, using an escape
character of hash (\verb|#|) and right delimiters of dash (\verb|-|) and
right square bracket (\verb|]|), respectively.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script which removes the value under the
Shell Execute Hooks registry key, and the associated key under
HKCR\textbackslash{}CLSID.
``Move'' shall generate a script which quarantines the indicated DLL.
\end{description}

\subsubsection{Security Providers}
\begin{description}
\item[Rationale] \hfill \\
Security providers are loaded by the security subsystems of Windows and provide
features such as authentication.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SecurityProviders]
"SecurityProviders"="${Providers}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|SecurityProviders: ${File}|
\item[Output Description] \hfill \\
\var{Providers} is a whitespace or comma separated list of values. A separate
log line shall be generated for each item in the list.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script removing the offending security provider from
the registry value. ``Move'' shall generate a script moving the targeted file
into quarantine.
\end{description}

\subsubsection{Local Security Authority Settings}
\begin{description}
\item[Rationale] \hfill \\
The Local Security Authority is responsible for user mode privilege checks. As
such, it runs with a high level of privilege itself, and provides loading points
which allow third party code to run inside \verb|lsass.exe|.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa]
"Authentication Packages"=multisz:${AuthenticationPackages}
"Notification Packages"=multisz:${NotificationPackages}
"Security Packages"=multisz:${SecurityPackages}
\end{verbatim}
\item[Log Format] \hfill \\
\verb|AuthenticationPackage: ${File}| \\
\verb|AuthenticationMissing: ${PackageName}| \\
\verb|NotificationPackage: ${File}| \\
\verb|NotificationMissing: ${PackageName}| \\
\verb|SecurityPackage: ${File}| \\
\verb|SecurityMissing: ${PackageName}|
\item[Output Description] \hfill \\
All of the indicated registry values are of type \verb|REG_MULTI_SZ|. This
means that the registry item contains a double null terminated list of null
terminated strings. For each string, the local security authority loads the
indicated DLL. Each string therefore generates a separate Instalog log line.
\var{File} is displayed using the standard file format defined in \ref{stdfile}.

If the default values are not in place, the machine may be in a state where the
user cannot log in. Therefore, if any of the defaults are missing, the
indication that the item expected is missing needs to be generated. Testing will
need to be done to determine the whitelisted items on supported operating
systems.
\item[Whitelisting Considerations] \hfill \\
As described above.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a fix removing the associated value from the registry.
``Move'' shall generate a fix quarantining the affected file.
\end{description}

\subsubsection{Client Server Runtime SubSystem Server DLL}
\begin{description}
\item[Rationale] \hfill \\
The Client Server Runtime Subsystem is responsible for implementing the Win32
API, on top of the native (NT) API provided by the NT kernel. This subsystem
runs inside the process known as ``\verb|csrss.exe|''. While Windows is
starting, NT passes a long command line into \verb|csrss.exe| which tells it the
paths of some important DLLs. One of these is the ``Server'' DLL, which
malware has used as a loading point in the past.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\
    Subsystems]
"Windows"="${CsrssCommandLine}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|SubSystems: ${File}|
\item[Output Description] \hfill \\
\var{CsrssCommandLine} is the full command line used to launch the Client Server
Runtime SubSystem. An example command line (with newlines to get it to fit here)
is:
\begin{verbatim}
%SystemRoot%\system32\csrss.exe ObjectDirectory=\Windows
SharedSection=1024,20480,768 Windows=On SubSystemType=Windows
ServerDll=basesrv,1
ServerDll=winsrv:UserServerDllInitialization,3
ServerDll=winsrv:ConServerDllInitialization,2
ServerDll=sxssrv,4 ProfileControl=Off MaxRequestThreads=16
\end{verbatim}

The first ``ServerDll'' is overwritten by malware to load a malicious DLL.
\var{File} consists of the first ServerDll portion, starting just after the
equals sign (\verb|=|), and continuing until the comma (\verb|,|).

After \var{File} is determined, it is displayed using the standard file format
defined in \ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
The default value, \verb|basesrv|, of the indicated file shall be whitelisted.
\item[Fix Considerations] \hfill \\
The ``Fix'' action shall generate a registry script resetting the default
value for the target operating system. The ``Move'' action shall generate a
script quarantining the indicated DLL.
\end{description}

\subsubsection{Installed Active Setup Components}
\begin{description}
\item[Rationale] \hfill \\
From Wikipedia:
\url{http://en.wikipedia.org/wiki/Active_Setup}

\begin{quote}
Active Setup is the installation technology Microsoft used for downloading and
installing Internet Explorer versions 4 to 6. It was designed to selectively
download and install signed Internet Explorer components via the Internet.
This significantly reduced the amount of data to download as also the time
required for updates. Active Setup could also resume partially completed
downloads from the point where they were interrupted.

Active Setup was also used for Microsoft Outlook 98 setup.

Active Setup still available into Windows 7. It is mainly used to complete
specific run once setup tasks for each user as they log in to a given
machine after an active setup based package is installed. This can be
used as a complementary technology to the MSI Self-heal feature, but is
not dependent or related to MSI technology.
\end{quote}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\Software\Microsoft\Active Setup\
    Installed Components\${Entry}]
"StubPath"="${File}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|ActiveSetup: [${Entry}] ${File}|
\verb|ActiveSetup64: [${Entry}] ${File}|
\item[Output Description] \hfill \\
\var{Entry} shall be escaped using the default escape function defined in
\var{generalescape}, using an escape character of hash (\verb|#|), and a right
delimiter of right square bracket (\verb|]|). \var{File} shall be displayed
using the default file display method defined in \ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a script removing the associated \var{Entry} subkey.
``Move'' shall generate a script quarantining the indicated file.
\end{description}

\subsubsection{Image File Execution Options}
\begin{description}
\item[Rationale] \hfill \\
Image File Execution Options are used by the Windows Loader to control how a
given binary is loaded. This allows debuggers, for instance, to be loaded early
in the process before the Windows Loader does significant work resolving DLLs,
libraries, and other bits.

This means that when the Windows Loader tries to load a binary it finds settings
for in the Image File Execution Options section, the debugger, if defined, is
loaded instead of the indicated binary. Malware uses this to redirect
otherwise legitimate programs into launching malware instead.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\
    Image File Execution Options\${Source}]
"Debugger"="${Target}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|Ifeo: ${Source}->${Target}|
\item[Output Description] \hfill \\
\var{Source} shall be escaped using the default escaping method defined in
\ref{generalescape}, using an escape character of hash (\verb|#|), and a right
delimiter of dash (\verb|-|). \var{Target} shall be displayed using the default
file display format defined in \ref{stdfile}.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a fix removing the ``Debugger'' value from the indicated
Image File Execution Options key. ``Move'' shall generate a script quarantining
the indicated \var{Target}.
\end{description}

\subsubsection{File Assocations}
\begin{description}
\item[Rationale] \hfill \\
File associations tell Windows how to deal with a particular file given its
extension. Malware can steal file associations which are important to general
operation of the system, such as that given to ``\verb|.exe|''.
\item[Data Sources] \hfill \\
The following file extensions shall be checked:
\begin{itemize}
    \item \verb|.exe|
    \item \verb|.bat|
    \item \verb|.com|
    \item \verb|.pif|
    \item \verb|.scr|
    \item \verb|.reg|
    \item \verb|.txt|
    \item \verb|.chm|
    \item \verb|.inf|
    \item \verb|.ini|
    \item \verb|.vbe|
    \item \verb|.vbs|
    \item \verb|.jse|
    \item \verb|.jsf|
\end{itemize}

For each of these extensions, the following data is queried:

\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_CLASSES_ROOT\${Ext}]
@="${NamedExt}"
[HKEY_CLASSES_ROOT\${NamedExt}\Shell]
@="${DefaultVerb}"
[HKEY_CLASSES_ROOT\${NamedExt}\Shell\${DefaultVerb}\Command]
@="${Cmd}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|Association: ${Ext}->${NamedExt}->${DefaultVerb}->${Cmd}|
\item[Output Description] \hfill \\
All the variables are escaped using the general escape format defined in
\ref{generalescape}, using an escape character of hash (\verb|#|), and a right
delimiter of dash (\verb|-|), except \var{Cmd}, which has no right delimiter.
\item[Whitelisting Considerations] \hfill \\
None at this time.
\item[Fix Considerations] \hfill \\
``Fix'' shall generate a fix which restores default values for all of the above.
These defaults will need to be generated through testing.
\end{description}

\subsubsection{Hosts File}
\begin{description}
\item[Rationale] \hfill \\
The hosts file maps hostnames to IP addresses.  This file is sometimes modified
by software, so strange entries shall be reported.  
\item[Data Sources] \hfill \\
The hosts file is located at
\vspace{-\baselineskip}
\begin{verbatim}
%SystemRoot%\system32\drivers\etc\hosts
\end{verbatim}
This file is formatted quite simply.  Lines that begin with a \verb|#| are
comment lines.  The hosts file usually starts with several of these lines
explaining how the file is structured.  After this, IP address (\var{ip}) and
hostnames (\var{hostname}) pairs are listed.
\item[Log Format] \hfill \\
\verb|Hosts: ${ip} ${hostname}|
\item[Output Description] \hfill \\
The variable \var{url} shall be escaped using the URL escaping scheme defined in
\ref{urlescape}, where the escape character is the hash mark (\verb|#|).
\item[Whitelist Considerations] \hfill \\
Any entry in the hosts file with an \var{ip} value of \verb|127.0.0.1| or
\verb|::1| shall be whitelisted unless \var{hostname} contains one of the
following strings:
\begin{itemize}
  \item microsoft
  \item symantec
  \item mcafee
  \item f-secure
  \item kaspersky
  \item sophos
  \item trendmicro
  \item viruslist
  \item virustotal
  \item avast
  \item avira
  \item bitdefender
  \item bleepingcomputer
  \item eset
  \item majorgeeks
  \item free-av
  \item avg
  \item grisoft
  \item geekstogo
  \item pandasecurity
  \item spywareinfo
  \item sunbeltsecurity
  \item techspot
  \item techsupportforum
  \item whatthetech
  \item wilderssecurity
\end{itemize}
\item[Fix Considerations] \hfill \\
Neither ``Fix'' nor ``Move'' are valid. The user is expected to reset the hosts
file completely if need be.
\end{description}

\subsubsection{User Only Line Types}
The following lines are displayed in user Load Points reports only.

\subsubsection{Internet Connection Wizard Shell Next}
\begin{description}
\item[Rationale] \hfill \\
This is the location a user is dropped to after completing the Internet
Connection Wizard.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Connection Wizard]
"ShellNext"="${url}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|InternetConnectionWizard: ${url}|
\item[Output Description] \hfill \\
The variables \var{url} is escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
This value is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the
``\verb|ShellNext|'' value above.
\end{description}

\subsubsection{Proxy Server}
\begin{description}
\item[Rationale] \hfill \\
The proxy server configured for the user; through which all Internet traffic is
directed.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\Internet Settings]
"ProxyServer"="${proxy}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|ProxyServer: ${proxy}|
\item[Output Description] \hfill \\
The variable \var{proxy} is escaped using the general escaping method defined in
\ref{generalescape}, using the escape character \verb|#|.
\item[Whitelist Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the
``\verb|ProxyServer|'' value above.
\end{description}

\subsubsection{Proxy Override}
\begin{description}
\item[Rationale] \hfill \\
A setting which overrides the proxy server setting; addresses configured here
bypass the proxy server and go directly to the default gateway.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\Internet Settings]
"ProxyOverride"="${override}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|ProxyOverride: ${override}|
\item[Output Description] \hfill \\
The variable \var{override} is escaped using the general escaping method defined
in \ref{generalescape}, using the escape character \verb|#|.
\item[Whitelist Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the
``\verb|ProxyOverride|'' value above.
\end{description}

\subsubsection{INI Autostarts}
\begin{description}
\item[Rationale] \hfill \\
These autostart locations are maintained by Windows for compatibility with the
Win9x series of operating systems.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows NT\CurrentVersion\Windows]
"Load"="${Load}"
"Run"="${Run}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|IniLoad: ${Load}| \\
\verb|IniRun: ${Run}|
\item[Output Description] \hfill \\
The variables \var{Load} and \var{Run} shall be escaped using the general
escaping method defined in \ref{generalescape}, using an escape character of
hash (\verb|#|).
\item[Whitelist Considerations] \hfill \\
Not applicable.
\item[Fix Considerations] \hfill \\
The option ``Fix'' shall generate a script which deletes the associated
registry value.
\end{description}

\subsubsection{Startup Folder}
\begin{description}
\item[Rationale] \hfill \\
The startup folder contains a set of links that Windows launches when a user
logs in. However, it will also cause direct executables to be run if they are
placed there.
\item[Data Sources] \hfill \\
\verb|%USERPROFILE%\Start Menu\Startup\${Link}|
\item[Log Format] \hfill \\
\verb|StartupFolder: ${Link}->${Target}| \\
\verb|StartupFolder: ${Link}|
\item[Output Description] \hfill \\
In the case the file enumerated as \var{Link} can be interpreted as a Windows
Link (that is, can be recognised using the \verb|IShellLink| interface), the
first form the log line is used. In such cases, \var{Link} is escaped using the
general escaping format using an escape character of hash (\verb|#|), and a
right delimiter of dash (\verb|-|), and \var{Target} is the resolved target of
the link file indicated in \var{Link}, which is displayed using the default file
output defined in \ref{stdfile}.

In the case that \var{Link} cannot be interpreted as a link, it shall use the
second format, and \var{Link} shall be output using the default file output
defined in \ref{stdfile}.
\end{description}

\subsection{Firefox (\texttt{:Firefox})}
Firefox (hereafter referred to as simply ``Firefox'') is a popular web
browser that many users have installed on their machines.  An attack from within
the browser is a possibility.  As such, this tool must enumerate various Firefox
loading points to find suspicious information (if Firefox is installed).  This
is determined by checking to see if the \var{version} is set in the following
registry key:
\begin{verbatim}
[HKEY_LOCAL_MACHINE\SOFTWARE\Mozilla\Mozilla Firefox] 
"Current Version"="${version}
\end{verbatim}

If Firefox is installed, the following information shall be output to the log. 
If Firefox is not installed, the entire section shall not be printed to the log.

This can be invoked in a script by calling \verb|:Firefox|.  This action does
not require any argument or additional input.  However, if additional input
lines are supplied, then the scan action will assume that they are user
preferences and they shall be enumerated in addition to the default preferences
listed in \ref{sec:ff_user_preferences}.

This specification is targeted for Firefox 10.0 x86 builds.  The behavior is
undefined for other versions of Firefox but will likely be similar.

\subsubsection{Profile}
\begin{description}
\item[Rationale] \hfill \\
Firefox stores its user settings in ``profiles''.  Each profile is a directory
on disk.  
\item[Data Sources] \hfill \\
The profiles are stored in the following location:
\vspace{-\baselineskip}
\begin{verbatim}
%APPDATA%\Roaming\Mozilla\Firefox\Profiles\${profilefolder}
\end{verbatim}
There can be several profiles installed for each user.   All profiles in this
directory with randomly generated folder names of 8 characters.  The profile
that starts up when Firefox loads will be in the randomly named folder appended
by ``\verb|.default|''.  It shall be sufficient to only enumerate the default
profile for the currently logged in user.
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
ProfilePath ${profilefolder}
\end{verbatim}
\item[Output Description] \hfill \\
\var{profilefolder} shall be escaped using the scheme described in
\ref{generalescape}, where the escape character is the hash mark (\verb|#|) and
the right delimiter is just the newline.
\item[Whitelist Considerations] \hfill \\
This item cannot be whitelisted as it is unique to each user's machine.
\item[Fix Considerations] \hfill \\
There are no fix actions associated with the profile path.  The profile path is
provided so that further fix actions can be applied to components within the
path.
\end{description}

\subsubsection{User Preferences} \label{sec:ff_user_preferences}
\begin{description}
\item[Rationale] \hfill \\
Some user preferences could be overridden that would lead a user to malicious
pages.  
\item[Data Sources] \hfill \\
User preferences are located in the ``\verb|${profile path}/prefs.js|'' file. 
The preferences are saved in JSON. There are several different
``loading points'' from this file that could be important for diagnosing an
infection:
\begin{itemize}
  \item \verb|browser.startup.homepage|
  \item \verb|network.proxy.type|
\end{itemize}
The name of the preference will be referred to as \var{preference} and the
value to which that preference is set as \var{value}.  If a preference does not
have a name, \var{value} shall default to ``not set''.
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
${preference}=${value}
\end{verbatim}
This line shall be printed for every \var{preference} listed in Data Sources.
\item[Output Description] \hfill \\
\var{value} must be escaped using the URL escaping scheme defined in
\ref{urlescape}, where the escape character is the hash mark (\verb|#|).
\item[Whitelist Considerations] \hfill \\
The default values for each preference shall be whitelisted.  These values are
enumerated below:
\begin{enumerate}
  \item \verb|browser.startup.homepage = about:home|
  \item \verb|network.proxy.type = 5|
\end{enumerate}

\item[Fix Considerations] \hfill \\
A sensible fix for these items is to simply delete the corresponding key and
value from \verb|prefs.js|.  Firefox will then reset the preference to the
default value the next time it loads.

Firefox must not be running for this to work.  If a script is supposed to fix
any of the preferences and Firefox is running, a dialog must appear warning the
user that Firefox will be closed.  When the user hits okay in this dialog, the
Firefox process can be killed if it is still running and the preference(s)
reset.
\end{description}

\subsubsection{Extensions and Themes}
\begin{description}
\item[Rationale] \hfill \\
Firefox allows users to add to the functionality of their browser through
``extensions'' (sometimes called addons).  These extensions can be malicious in
nature.  Extensions need not be installed by the user; they can be installed
outside Firefox as well by placing extensions in the profile directory and
relaunching Firefox.  Themes are loaded in the same manner as extensions and
therefore must also be enumerated.
\item[Data Sources] \hfill \\
Extension metadata is stored in an SQLite 3 database located in \\
\verb|${profilepath}/extensions.sqlite|.  There are two tables in this database
that are of interest: \verb|addon| and \verb|locale|. 
 
The output variables are defined as:
\begin{description}
  \item[\var{visible}] \verb|addon.visible| attribute.  This shall be output as
  a binary 0 or 1 value.
  \item[\var{active}] \verb|addon.active| attribute.  This shall be output as a
  binary 0 or 1 value.
  \item[\var{name}] \verb|locale.name| attribute where \texttt{locale.id =
  addon.defaultLocale}
  \item[\var{version}] \verb|addon.version| attribute
  \item[\var{type}] \verb|addon.type| attribute
  \item[\var{path}] \verb|addon.descriptor| attribute
\end{description}
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
${type} ${visible} ${active} ${version} "${name}" ${type} ${path}
\end{verbatim}
\item[Output Description] \hfill \\
\var{name} shall be escaped according to the scheme defined in
\ref{generalescape} with \verb|#| as the escape character and double quotes
(\verb|"|) as the right delimiter.  \var{path} shall be escaped according to
the scheme defined in \ref{generalescape} with \# as the escape character and
the newline as the right delimiter.
  
\item[Whitelist Considerations] \hfill \\
No whitelist actions apply here
\item[Fix Considerations] \hfill \\
To fix these items, the \var{path} simply needs to be deleted.  This must
happen while Firefox is not running.  If a script is supposed to fix an
extension and Firefox is running, a dialog must appear warning the user that
Firefox will be closed.  When the user hits okay in this dialog, the Firefox
process can be killed if it is still running.  When the user re-opens Firefox
later, the extension(s) or theme(s) will be removed from the database.
\end{description}

\subsubsection{Plugins}
\begin{description}
\item[Rationale] \hfill \\
Firefox, like most major browsers, supports plugins.  These are a potential
attack vector and shall be scanned.  
\item[Data Sources] \hfill \\
Firefox maintains a list of plugins in \texttt{\var{profilepath}/pluginreg.dat}.
This file is structured in a specific way.  Everything below the line labeled
``\texttt{[PLUGINS]}'' is imported for this tool.  Each plugin is listed below
this line, each in its own ``block''.  These ``block'' are all structured
similarly, and follow the same format:
\begin{verbatim}
${file name}|$
${full file path}|$
${version}|$
${installed timestamp}|${unknown?}|${unknown?}|$
${description}|$
${name}|$
${mime type count}
0|${mime type}|$
1|${mime type}|$
...
${${mime type count} minus 1}|${mime type}|$
\end{verbatim}
Each plugin ``block'' is put immediately after the last plugin ``block'' with no
other separation.  It shall be enough to read through to the
``\texttt{[PLUGINS]}'' line and keep parsing ``block'' until the
``\texttt{[INVALID]}'' line is reached.
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
Plugin "${name}" "${version}" "${path}"
\end{verbatim}
\item[Output Description] \hfill \\
\var{name} shall be escaped according to the scheme
defined in \ref{generalescape} with \verb|#| as the escape character and double
quotes (\verb|"|) as the right delimiter.  \var{path} shall be escaped
according to \ref{generalescape} as well with \verb|#| as the escape character
and the newline as the right delimiter.  
\item[Whitelist Considerations] \hfill \\
No whitelist actions are necessary.  
\item[Fix Considerations] \hfill \\
To fix these items, the \var{path} simply needs to be deleted.  This must
happen while Firefox is not running.  If a script is supposed to fix an
plugin and Firefox is running, a dialog must appear warning the user that
Firefox will be closed.  When the user hits okay in this dialog, the Firefox
process can be killed if it is still running.  When the user re-opens Firefox
later, the plugins(s) will be removed from the file.
\end{description}

\subsection{Chrome (\texttt{:Chrome})}
Google Chrome (hereafter referred to as ``Chrome'') is a popular browser that is
extensible like Firefox.  Therefore, like Firefox, it has some potential attack
vectors.  This section of the log shall only appear if Chrome is installed.  To
determine if Chrome is installed for the current user, the tool shall check to
see if the \texttt{Chrome.exe} executable exists in the following path:
\begin{verbatim}
%userprofile%\AppData\Local\Google\chrome.exe
\end{verbatim}

If Chrome is installed, the following information shall be output to the log. 
If Chrome is not installed, the entire section shall not be printed to the log.

This can be invoked in a script by calling \verb|:Chrome|.  This action does
not require any argument or additional input.  However, if additional input
lines are supplied, then the scan action will assume that they are user
preferences and they shall be enumerated in addition to the default preferences
listed in \ref{sec:chrome_user_preferences}.

This specification is targeted at Chrome 17.0.  While this information extend
to other versions of the browser, the behavior will be undefined.  

All of the various sections for Chrome pull from the same Preferences file:
\begin{verbatim}
%userprofile%\AppData\Local\Google\Chrome\User Data\Default\Preferences
\end{verbatim}
This is a JSON file that contains most of the important settings for a user.  In
this document, to address JSON locations, the successive keys of each object
will be given.  For example, if the JSON file were:
\begin{verbatim}
{
    "a": {
        "one": true,
        "two": false,
        "three": {
            "i": "stringvalue"
        }
    }
    "b": 1234
}
\end{verbatim}
In this case, simply stating ``\texttt{a}'' would refer to the ``\texttt{a}''
object and all of its children.  Similarly, ``\texttt{a.three}'' would refer to
the ``\texttt{three}'' object in the ``\texttt{a}'' object.  To access values,
a full key shall be given (``\texttt{a.one}'', ``\texttt{a.two}'',
``\texttt{a.three.i}'', or ``\texttt{b}'').  

A ``\texttt{*}'' indicates that any string can be used and will return a set of
objects that match the specified string.  For example, ``\texttt{a.*}'' would
return ``\texttt{a.one}'', ``\texttt{a.two}'', and ``\texttt{a.three}'' and
``\texttt{a.*.i}'' would return ``\texttt{a.three.i}.

\subsubsection{Extensions}
\begin{description}
\item[Rationale] \hfill \\
Chrome allows users to add to the functionality of their browser through
``extensions'' (sometimes called addons).  These extensions can be malicious in
nature.   Each extension is installed into its own randomly named folder inside
\vspace{-\baselineskip}
\begin{verbatim}
%userprofile%\AppData\Local\Google\Chrome\User Data\Default\Extensions\
\end{verbatim}
\item[Data Sources] \hfill \\
All of the data for the extensions is available in the aforementioned
Preferences file.  Each extension has its own object created inside
\texttt{extensions.settings}.  Therefore, each extension can be enumerated by
listing the set of \texttt{extensions.settings.*}.  For each extension in this
set (hereafter referred to as \texttt{e}), the following variables are defined:
\begin{description}
\item[\var{state}] \texttt{e.state}
\item[\var{name}] \texttt{e.mainfest.name}
\item[\var{version}] \texttt{e.manifest.version}
\item[\var{id}] The object key of \texttt{e}
\end{description}
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
Extension ${state} ${id} ${version} "${name}"
\end{verbatim}
\item[Output Description] \hfill \\
\var{name} shall be escaped according to \ref{generalescape} with an escape
character of \verb|#| and a right delimiter of double quotes (\verb|"|). 

\item[Whitelist Considerations] \hfill \\
A default Chrome installation has several safe extensions installed.  Extensions
shall be whitelisted if their \var{name} matches any of the following
extensions:
\begin{itemize}
\item ``YouTube''
\item ``Google Search''
\item ``Gmail''
\end{itemize}
\item[Fix Considerations] \hfill \\
To remove a Chrome extensions, two actions must be taken.  First, the entire
extension object must be removed from the Preferences file for the given
extension \var{id}.  Secondly, the extension must be removed from the
filesystem.  This can be achieved by deleting the directory 
\vspace{-\baselineskip}
\begin{verbatim}
%userprofile%\AppData\Local\Google\Chrome\User Data\Default\Extensions\${id}
\end{verbatim}

Chrome must not be running for this operation to proceed.  If Chrome is running,
a dialog must appear warning the user that Chrome will be closed.  When the
user hits okay in this dialog, the Chrome process can be killed if it is still
running.  
\end{description}

\subsubsection{Plugins}
\begin{description}
\item[Rationale] \hfill \\
Chrome, like most major browsers, supports plugins.  These are a potential
attack vector and shall be scanned.
\item[Data Sources] \hfill \\
The list of plugins is available in the Preferences file.  Each plugin is listed
inside a JSON list located in \verb|plugins.plugins_list|.  For each plugin,
\texttt{p} in this list, the following variables are defined:
\begin{description}
\item[\var{name}] \texttt{p.name}
\item[\var{version}] \texttt{p.version}
\item[\var{path}] \texttt{p.path}
\end{description}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
Plugin ${version} "${name}" ${path}
\end{verbatim}
\item[Output Description] \hfill \\
\var{name} shall be escaped according to the scheme defined in
\ref{generalescape} with \verb|#| as the escape character and double quotes
(\verb|"|) as the right delimiter.  \var{path} shall be escaped according to
\ref{generalescape} as well with \verb|#| as the escape character and the
newline as the right delimiter.
\item[Whitelist Considerations] \hfill \\
None.
\item[Fix Considerations] \hfill \\
To fix these items, the \var{path} simply needs to be deleted.  This must
happen while Chrome is not running.  If a script is supposed to fix a
plugin and Chrome is running, a dialog must appear warning the user that
Chrome will be closed.  When the user hits okay in this dialog, the Chrome
process can be killed if it is still running.  
\end{description}

\subsubsection{Other user preferences} \label{sec:chrome_user_preferences}
\begin{description}
\item[Rationale] \hfill \\
Some other user preferences, such as homepages and such could become infected by
malware.  Therefore, these preferences shall be scanned.
\item[Data Sources] \hfill \\
Each of the preferences comes from the Preferences file.  The following
preferences shall be enumerated:
\begin{itemize}
  \item \verb|default_search_provider.search_url|
  \item \verb|homepage|  
\end{itemize}
The name of the preference shall be referred to as \var{name} and the
corresponding value as \var{value}.  If no value is available, \var{value}
shall be set to ``not set''.
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
Preference ${name} ${value}
\end{verbatim}
This line shall be printed for each preference listed in the Data Sources.
\item[Output Description] \hfill \\
\var{value} must be escaped using the URL escaping scheme defined in
\ref{urlescape}, where the escape character is the hash mark (\verb|#|).
\item[Whitelist Considerations] \hfill \\
If the \var{name} is \verb|default_search_provider.search_url|, then the default
value is:
\vspace{-\baselineskip}
\begin{verbatim}
"{google:baseURL}search?{google:RLZ}{google:acceptedSuggestion}{google:
originalQueryForSuggestion}{google:searchFieldtrialParameter}{google:
instantFieldTrialGroupParameter}sourceid=chrome&ie={inputEncoding}&q=
{searchTerms}"
\end{verbatim}
without the newlines.  This value could potentially be whitelisted.  
\item[Fix Considerations] \hfill \\
To fix these items, it is enough to simply delete the object in the Preferences
file with the given \var{name}.  This must happen while Chrome is not running. 
If a script is supposed to fix a preference and Chrome is running, a dialog must
appear warning the user that Chrome will be closed.  When the user hits okay in
this dialog, the Chrome process can be killed if it is still running.
\end{description}

\subsection{Services/Drivers (\texttt{:ServicesDrivers})}
The services and drivers section enumerates all services and drivers on the
current machine, limited by whitelist. Each line in this report is of the form
\begin{verbatim}
${State}${Start} ${ServiceName};${DisplayName};${File}
${State}${Start} ${ServiceName};${DisplayName};${SvchostGroup}->${SvchostDll}
\end{verbatim}

\noindent{}\var{State} is one of the following:
\begin{description}
\item[S] Service Stopped
\item[R?] Service Start Pending
\item[S?] Service Stop Pending
\item[R] Service Running
\item[C?] Service Continue Pending
\item[P?] Service Pause Pending
\item[P] Service Paused
\item[?] Unknown
\end{description}

Additionally, if the service indicated is part of a \verb|svchost| group as
indicated by the service's registered command line and image path, but the
service does not exist in the svchost registration for that group (located in
the registry at
\begin{verbatim}
[HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Svchost]
"${SvchostGroup}"=${Val}
\end{verbatim}
where \var{Val} is a \verb|REG_MULTI_SZ| containing a list of services in the
group) then the letter \verb|D| shall be appended to \var{State}, indicating
``Damaged''.

\noindent{}\var{Start} is one of the following:
\begin{quote}
\begin{description}
\item[0] \verb|SERVICE_BOOT_START| -- A device driver started by the system
loader. This value is valid only for driver services.
\item[1] \verb|SERVICE_SYSTEM_START| -- A device driver started by the
\verb|IoInitSystem| function. This value is valid only for driver services.
\item[2] \verb|SERVICE_AUTO_START| -- A service started automatically by the
service control manager during system startup.
\item[3] \verb|SERVICE_DEMAND_START| -- A service started by the service control
manager when a process calls the \verb|StartService| function.
\item[4] \verb|SERVICE_DISABLED| -- A service that cannot be started.
\end{description}
\end{quote}

\var{ServiceName} is the registry name used for the service. \var{DisplayName}
is the name the service advertises itself as. \var{File} is the image path
configured for the service. If \var{File}, after going through the standard
resolution process defined in \ref{pathresolution}, corresponds to one of the
\verb|svchost.exe| processes on the machine, and has arguments of the form
``\verb| -k ${SvchostGroup}|'', then the service shall be interpreted as a
``svchost type'' service, and the group printed using the second line format
above. In such cases, Instalog shall enumerate the key
\begin{verbatim}
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\${ServiceName}\Parameters]
"ServiceDll"="${SvchostDll}"
\end{verbatim}
and display \var{SvchostDll} using the standard file output format defined in
\ref{stdfile}. \var{SvchostGroup} shall be printed using the default escaping
format defined in \ref{generalescape}, using an escape character of hash
(\verb|#|) and a right delimiter of dash (\verb|-|).

Otherwise (the service is not a svchost type service), \var{File} shall be
printed directly, also using the standard file output format.

This action be invoked in a script by calling \verb|:ServicesDrivers|.  This
action does not require any argument or additional input.

\subsection{Created Last 30 (\texttt{:CreatedLast30})}
Created Last 30 is designed to be look in interesting locations for files
created in the last 30 days. It is defined by sUBs' DDS tool, and shall be used,
almost verbatim, in Instalog.

Each line of the Created Last 30 report shall use the file listing format
defined in section \ref{filelisting}.

Created Last 30 shall enumerate the following directories:
\begin{itemize}
    \item \verb|%SystemRoot%\System32\drivers|
	\item \verb|%SystemRoot%\System32\wbem|
	\item \verb|%SystemRoot%\System32|
	\item \verb|%SystemRoot%\system|
	\item \verb|%SystemRoot%|
	\item \verb|%Systemdrive%|
	\item \verb|%Systemdrive%\temp|
	\item \verb|%userprofile%|
	\item \verb|%commonprogramfiles%|
	\item \verb|%programfiles%|
	\item \verb|%AppData%|
	\item \verb|%AllUsersprofile%|
\end{itemize}
and the following additional directories on x64 machines:
\begin{itemize}
	\item \verb|%SystemRoot%\SysWow64|
	\item \verb|%ProgramFiles(x86)%|
	\item \verb|%CommonProgramFiles(x86)%|
\end{itemize}
and the following additional directories on Vista or newer.
\begin{itemize}
    \item \verb|%Common Appdata%|
\end{itemize}

The output will then be sorted by creation date, then by modification date, then
by size, then by attribute string, and finally by file path.

This action can be invoked in a script by calling \verb|:CreatedLast30|.
This action does not require any argument or additional input.

\subsection{Find3M (\texttt{:Find3M})}
Find3M is modelled after sUBs' DDS, almost without modification. It
originally stood for ``Find files created in the last 3 months'', but has since been expanded to
cover cases where files are in strange locations where they otherwise should not
be. The output is a file listing, following the format defined in section
\ref{filelisting}.

Find3M shall be generated in the following manner:
\begin{enumerate}
    \item Enumerate the directories
    \begin{itemize}
        \item Program Files
        \item Common Program Files
    \end{itemize}
    \item Enumerate files modified more recently than 3 months ago:
    \begin{itemize}
        \item Application Data
        \item Common Application Data
        \item System Drive
        \item Windows Directory
        \item Windows Directory \textbackslash System32
        \item Userprofile
        \item All Users' Profile (If the current operating system is Vista or
        later)
    \end{itemize}
    \item The above comprise \var{List1}. Discard entries which do not have one
    of the following extensions:
    \begin{itemize}
        \item \verb|bat|
        \item \verb|reg|
        \item \verb|vbs|
        \item \verb|wsf|
        \item \verb|vbe|
        \item \verb|msi|
        \item \verb|msp|
        \item \verb|com|
        \item \verb|pif|
        \item \verb|ren|
        \item \verb|vir|
        \item \verb|tmp|
        \item \verb|dll|
        \item \verb|scr|
        \item \verb|sys|
        \item \verb|exe|
        \item \verb|bin|
        \item \verb|drv|
    \end{itemize}
    \item Discard those items which are not executables (see section
    \ref{executables}) from \var{List1}.
    \item Enumerate the following directories recursively. This comprises
    \var{List2}.
    \begin{itemize}
        \item Windows Directory \textbackslash \verb|System|
        \item Windows Directory \textbackslash \verb|System32\Wbem|
        \item Windows Directory \textbackslash
        \verb|system32\GroupPolicy\Machine\Scripts\Shutdown|
        \item Windows Directory \textbackslash
        \verb|system32\GroupPolicy\User\Scripts\Logoff|
    \end{itemize}
    \item Discard entries from \var{List2} which are not executables and have
    one of the following extensions:
    \begin{itemize}
        \item \verb|com|
        \item \verb|pif|
        \item \verb|ren|
        \item \verb|vir|
        \item \verb|tmp|
        \item \verb|dll|
        \item \verb|scr|
        \item \verb|sys|
        \item \verb|exe|
        \item \verb|bin|
        \item \verb|dat|
        \item \verb|drv|
    \end{itemize}
    and discard those files which are not directories, and have one of the
    following extensions:
    \begin{itemize}
        \item \verb|bat|
        \item \verb|cmd|
        \item \verb|reg|
        \item \verb|vbs|
        \item \verb|wsf|
        \item \verb|vbe|
        \item \verb|msi|
        \item \verb|msp|
    \end{itemize}
    \item Enumerate executables (see section \ref{executables}) in Windows
    Directory \textbackslash \verb|System32\Spool\prtprocs\w32x86|, forming 
    \var{List3}.
    \item If the current machine is an x64 machine, enumerate the following
    directories, forming \var{List4}:
    \begin{itemize}
        \item Program Files (x86)
        \item Common Program Files (x86)
        \item Windows Directory \textbackslash Syswow64 (More recently than 3
        months ago)
        \item Windows Directory \textbackslash \verb|Syswow64\Drivers|
        (Recursively)
        \item Windows Directory \textbackslash \verb|Syswow64\Wbem|
        (Recursively)
    \end{itemize}
    \item Enumerate \var{List5} as the following directories, recursively:
    \begin{itemize}
		\item \verb|%Systemroot%\java|
		\item \verb|%Systemroot%\msapps|
		\item \verb|%Systemroot%\pif|
		\item \verb|%Systemroot%\Registration|
		\item \verb|%Systemroot%\help|
		\item \verb|%Systemroot%\web|
		\item \verb|%Systemroot%\pchealth|
		\item \verb|%Systemroot%\srchasst|
		\item \verb|%Systemroot%\tasks|
		\item \verb|%Systemroot%\apppatch|
		\item \verb|%Systemroot%\Internet Logs|
		\item \verb|%Systemroot%\Media|
		\item \verb|%Systemroot%\prefetch|
		\item \verb|%Systemroot%\cursors|
		\item \verb|%Systemroot%\inf|
    \end{itemize}
    \item Eliminate items from \var{List5}, using the same rules that were used
    for \var{List1} above.
    \item Form \var{List6} by enumerating \verb|%SystemRoot%\Fonts| recursively,
    and keeping only those files which have sizes between 1500 and 2000 bytes,
    or have size greater than 1500 bytes, are executables (see section
    \ref{executables}), and have one of the following extensions:
    \begin{itemize}
        \item \verb|com|
        \item \verb|pif|
        \item \verb|ren|
        \item \verb|vir|
        \item \verb|tmp|
        \item \verb|dll|
        \item \verb|scr|
        \item \verb|sys|
        \item \verb|exe|
        \item \verb|bin|
        \item \verb|dat|
        \item \verb|drv|
    \end{itemize}
    \item Combine all the lists generated so far, and sort by creation date,
    then by modification date, then by size, then by attribute string, and
    finally by file path.
    \item Remove ``runs'' of files. That is, lines of files which are longer
    than 12 files long, which have creation date time differences of less than
    one second. (This is to remove Windows Update changes from the report).
    \item Remove files/directories that were already listed in the Created Last
    30 report.
    \item Crop the output to 100 files. (And indicate in the output if cropping
    was required)
\end{enumerate}

This action can be invoked in a script by calling \verb|:Find3M|.
This action does not require any argument or additional input.

\subsection{Event Viewer (\texttt{:EventViewer})}
The event viewer section shall enumerate event viewer messages from the past
week. Each line of this report shall match
\begin{verbatim}
${Date}, ${Type}: ${Source} [${EventId}] ${Description}
\end{verbatim}
where \var{Date} is the date the event was logged using the standard date format
(see section \ref{stddate}), \var{type} is the type of event log message
(currently ``Critical'', ``Error'', ``Warning'', or ``Information''),
\var{Source} is the service that generated the event log, \var{EventId} is the
ID that service has given the event, and \var{Description} is the human readable
description provided by the service.

All ``Warning'' and ``Informational'' messages will be not be logged, from the
default System and Application event logs. All messages (including Informational
and Warning) will be enumerated for Windows File Protection sourced events.

The \var{EventId}'s 1000, 8023, and 10010 are whitelisted, and shall not be
printed.

This action can be invoked in a script by calling \verb|:EventViewer|.
This action does not require any argument or additional input.

\subsection{Machine Specifications (\texttt{:MachineSpecifications})}
\begin{description}
\item[Rationale] \hfill \\
Sometimes it is helpful for a forum assistant to have an idea of what type of
machine the end user is working on.  This section's purpose is to provide this
type of information.
\item[Invocation] \hfill \\
This action can be invoked in a script by calling \verb|:MachineSpecifications|.
This action does not require any argument or additional input.
\item[Data Sources] \hfill \\
This segment is generated primarily from the \verb|Win32_ComputerSystem| class
in Windows Managment Instrumentation.
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
Boot Device: ${boot_device}
Install Date: ${install_date}
System Uptime: ${boot_time} (${uptime})
Motherboard: ${motherboard}
Processor: ${processor_0}
${drive_partitions}
\end{verbatim}
\var{drive\_partitions} is defined as a list of all of the drive partitions
on the system.  This list should list each partition on its own line.  There are
two different types of lines that are possible.  If the partition's size is not
available, the following line shall be printed:
\vspace{-\baselineskip}
\begin{verbatim}
${partition_letter}: is ${type}
\end{verbatim}
\var{partition\_letter} is simply the letter of the partition.  \var{type} is
the type of the disk (typically ``UNKNOWN'', ``NOROOT'', ``REMOVABLE'', ``LOCAL'',
``NETWORK'', ``CDROM'', or ``RAM'').  If the size is available, the following
line shall be printed:
\vspace{-\baselineskip}
\begin{verbatim}
${partition_letter}: is ${type} - ${total} GiB total, ${free} GiB free
\end{verbatim}
\var{total} is the total size of the disk and \var{free} is the free space
remaining on the disk.  Both of these values shall be reported in Gibibytes
(Giga Binary Bytes, 1 GiB = 1,073,741,824 bytes).

\item[Output Description] \hfill \\
None of the variables need to be escaped.
\item[Whitelist Considerations] \hfill \\
There are no applicable whitelist considerations.
\item[Fix Considerations] \hfill \\
No applicable fix considerations apply.  
\end{description}

\subsection{Restore Points (\texttt{:RestorePoints})}
\begin{description}
\item[Rationale] \hfill \\
Restore Points were introduced in Windows XP.  They allow a user to return their
system to a previous state.  These restore points are typically created when a
major system event occurs (application installs / uninstalls), driver changes,
etc.  Users can also manually create restore points. 

If there are no restore points available or the system does not support restore
points, this entire log section shall be skipped.
\item[Invocation] \hfill \\
This action can be invoked in a script by calling \verb|:RestorePoints|.
This action does not require any argument or additional input.
\item[Data Sources] \hfill \\
Restore Points can be accessed using WMI
(\url{http://msdn.microsoft.com/en-us/library/windows/desktop/aa378951.aspx}),
which exposes a list of \texttt{SystemRestore} classes:
\vspace{-\baselineskip}
\begin{verbatim}
class SystemRestore
{
  String Description;
  uint32 RestorePointType;
  uint32 EventType;
  uint32 SequenceNumber;
  String CreationTime;
};
\end{verbatim}
From this class, the variables that shall be logged are \texttt{Description},
\texttt{SequenceNumber}, and \texttt{CreationTime} and will be referred to as
\var{description}, \var{number}, and \var{time} respectively.
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
${number} ${time} ${description}
\end{verbatim}
\item[Output Description] \hfill \\
\var{description} shall be escaped using the scheme defined in
\ref{generalescape} with \verb|#| as the escape character.  
\item[Whitelist Considerations] \hfill \\
There are no applicable whitelist considerations.
\item[Fix Considerations] \hfill \\
No applicable fix considerations apply.  Future versions of this tool may
support restoring to a certain point.  
\end{description}

\subsection{Installed Programs (\texttt{:InstalledPrograms})}
\begin{description}
\item[Rationale] \hfill \\
It is often important to have a full list of which programs are installed on a
user machine.  The output log shall contain a list of all installed programs. 
\item[Invocation] \hfill \\
This action can be invoked in a script by calling \verb|:InstalledPrograms|.
This action does not require any argument or additional input. 
\item[Data Sources] \hfill \\
The installed programs shall be determined by enumerating through the registry
for all of the \var{id}'s that are present.
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Uninstall\${id}]
"DisplayName"="${name}"
"VersionMajor"="${version_major}"
"VersionMinor"="${verison_minor}"
\end{verbatim}
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
${name} version ${version_major}.${version_minor}
\end{verbatim}
\item[Output Description] \hfill \\
None of the variables need to be escaped.
\item[Whitelist Considerations] \hfill \\
There are no applicable whitelist considerations.
\item[Fix Considerations] \hfill \\
No applicable fix considerations apply.  Future versions of this tool may
support uninstalling.  However, since some applications use non-standard
uninstallers, support uninstalling across the board could prove difficult.
\end{description}

\section{Log Output} \label{sec:log_output}
This section generally defines the form of Instalog's output. A log is split up
into several delimited portions called ``sections''. With the exception of
headers and footers, all sections begin with a line similar to the following
format:

\begin{verbatim}
================ ${Section Name} ===============
\end{verbatim}

That is, the name of the section with one space of padding, centered in a block
of equals (\verb|=|) signs 50 total characters wide. In the case that a tie
exists with respect to the centering, Instalog shall prefer placing the name of
the section farther to the right than to the left.

\subsection{Default Script Sections} \label{sec:default_script_sections}
Instalog's standard (that is, run without a script) output consists of the
following sections in the following order:
\begin{enumerate}
    \item Header
    \item Running Processes
    \item Machine PsuedoHJT Report
    \item $n$ User PseudoHJT Reports (One for each loaded user registry on the
    system)
    \item Mozilla Firefox (If Mozilla Firefox is installed)
    \item Google Chrome (If Google Chrome is installed)
    \item Created Last 30
    \item Find3M Report
    \item Event Viewer (If any relevant events need be reported)
    \item Machine Specifications
    \item Restore Points
    \item Installed Programs
    \item Footer
\end{enumerate}

\subsection{Additional Script Sections}
\noindent{}The following additional sections are available but they are not
generated in the default report:
\begin{description}
\item[DNS Check] Displayed if the \verb|:dnscheck| scripting section is used.
\item[Directory] Displayed if the \verb|:dirlook| scripting section is used.
\item[VirusTotal] Displayed if the \verb|:virustotal| scripting section is used.
\item[MRC Upload] Displayed if the \verb|:mrc| scripting section is used.
\item[Process Kill] Displayed if the \verb|:kill| scripting section is used.
\item[File Quarantine] Displayed if the \verb|:move| scripting section is used.
\item[Security Center] Displayed if the \verb|:securitycenter| scripting section
is used.
\item[Registry 32 Bit] Displayed if the \verb|:reg32| scripting action is used.
\item[Registry 64 Bit] Displayed if the \verb|:reg64| scripting action is used.
\end{description}

\subsection{Escaping Formats}
In order to meet the requirements of machine readability and human readability,
several escaping formats must be used depending on the type of data to produce
the most readable unambiguous representation given typical data collected from a
given location.

\subsubsection{General Escaping Format}
Generally, escaping MUST be done in a manner similar to most programming
languages, such as C, C++, Java, or similar, for quoted string escapes. Such an
escaping scheme is defined by three characters: an optional starting delimiter,
an optional termination delimiter, and an escape character. For instance, in C,
the starting delimiter is the quote mark, \verb|"|, the ending delimiter is also
a quote mark \verb|"|, and the escape character is the backslash \verb|\|.

For most types of information Instalog enumerates, such as Windows file paths,
the exact method C uses is unsuitable; backslashes occur far too often inside
file paths for the backslash as an escape character to make a good choice.
Legacy applications like the command processor (\texttt{cmd.exe}) get around
such problems by implementing complicated escaping schemes, but these are
designed with specific input data in mind (file paths and command line
switches, for instance), which is not the case for most reported data.

\label{generalescape}
Therefore, we define a general escape function that works in a manner similar to
C's string literal escapes, but which allows arbitrary starting, termination,
and escaping characters. The input to the escape function is raw data obtained
from some data source, and the output is the same data with the following
textual replacements:

\begin{itemize}
    \item \var{EscapeCharacter} is replaced with
    \var{EscapeCharacter}\var{EscapeCharacter}.
    \item \var{RightDelimiter}, if defined,  is replaced with
    \var{EscapeCharacter}\var{RightDelimiter}.
    \item The null character (ASCII \verb|0x00|) is replaced with
    \var{EscapeCharacter}\texttt{0}.
    \item The backspace character (ASCII \verb|0x08|) is replaced with
    \var{EscapeCharacter}\texttt{b}.
    \item The form feed character (ASCII \verb|0x0C|) is replaced with
    \var{EscapeCharacter}\texttt{f}.
    \item The newline character (ASCII \verb|0x0A|) is replaced with
    \var{EscapeCharacter}\texttt{n}.
    \item The carriage return character (ASCII \verb|0x0D|) is replaced with
    \var{EscapeCharacter}\texttt{r}.
    \item The horizontal tab character (ASCII \verb|0x09|) is replaced with
    \var{EscapeCharacter}\texttt{t}.
    \item The vertical tab character (ASCII \verb|0x0B|) is replaced with
    \var{EscapeCharacter}\texttt{v}.
    \item ASCII characters which are not in the above list but are unprintable
    (that is, ASCII \verb|0x00| - \verb|0x1F|; \verb|0x7F|) are
    replaced with \var{EscapeCharacter}\texttt{xHH}, where \texttt{HH} is the
    hexadecimal representation of the numeric value of the given character.
    \item Non-ASCII characters (\verb|U+0080| and above) are replaced with
    \var{EscapeCharacter}\texttt{uHHHH}, where \texttt{HHHH} is the hexadecimal
    representation of the numeric value of the character.
    \item Unicode characters requiring a surrogate pair in UTF-16 (that is,
    greater than U+FFFF) are represented as two normal Unicode
    (\var{EscapeCharacter}\texttt{uHHHH}) escapes matching the UTF-16 surrogate
    pair. (This is exactly how they'd be represented in Windows itself.)
    \item Forum software destroys significant whitespace; but escaping every
    space would be impractical. Where there is more than a single consecutive
    space, the second and later spaces are escaped. (That is, replaced with
    ``\var{EscapeCharacter}\texttt{ }''.)
    \item Any instance of \var{EscapeCharacter} followed by an unused character
    in the above list is equivalent to that character with no escape. This will
    never be generated by the escaping functionality in Instalog for general
    escaping, but is valid for the reverse, unescaping, operation.
\end{itemize}

\subsubsection{URL Escaping Format} \label{urlescape}
URL escaping matches the general escaping format above, except has the
additional constraint of forum software which tries to convert URLs into links.
It is desirable to inhibit this behavior of the forum software, so that board
owners need not worry about linking to malicious websites. Therefore, URL
escaping is defined to be general escaping with the additional requirement that
when the string ``\texttt{http}'' (case insensitive) appears, it is replaced
with ``\texttt{htt}\var{EscapeCharacter}\texttt{p}''. This inhibits forum
software's URL behavior which looks for the protocol prefix in order to
determine what portions of a post indicate a link. (Note that due to the last
requirement of general escaping this will cause no effect on the unescaped
data).

\subsubsection{CommandLineToArgvW Escaping Format} \label{winescape}
Windows' own \verb|CommandLineToArgvW| function defines it's own escaping
scheme. This format is delimited on both the left and right by quote (\verb|"|)
characters. Instalog shall interpret this format exactly as Windows' function
does. Quoting MSDN:
\begin{indent}
CommandLineToArgvW has a special interpretation of backslash characters when
they are followed by a quotation mark character (\verb|"|), as follows:
\begin{itemize}
    \item $2n$ backslashes followed by a quotation mark produce $n$ backslashes
    followed by a quotation mark.
    \item $(2n) + 1$ backslashes followed by a quotation mark again produce $n$
    backslashes followed by a quotation mark.
    \item $n$ backslashes not followed by a quotation mark simply produce $n$
    backslashes.
\end{itemize}
\end{indent}

\subsection{Date Formats}
Instalog shall use two date formats.

\subsubsection{Standard Date Format} \label{stddate}
The standard date format shall be defined as
\begin{verbatim}
${YYYY}-${MM}-${DD} ${HH}:${MM}:${SS}
\end{verbatim}
Where \var{YYYY} is the four digit year, \var{MM} is the two digit month,
\var{DD} is the two digit day, \var{HH} is the two digit hour, \var{MM} is the
two digit minute count, and \var{SS} is the two digit number of seconds.

If the given value is fewer than the number of digits available, they shall be
zero padded to take up as many spaces as that item has been assigned.

\subsubsection{Millisecond Date Format} \label{millidate}
The millisecond date format shall be defined as
\begin{verbatim}
${YYYY}-${MM}-${DD} ${HH}:${MM}:${SS}.${Milli}
\end{verbatim}
Where \var{YYYY} is the four digit year, \var{MM} is the two digit month,
\var{DD} is the two digit day, \var{HH} is the two digit hour, \var{MM} is the
two digit minute count, \var{SS} is the two digit number of seconds, and
\var{Milli} is the 4 digit number of miliseconds.

If the given value is fewer than the number of digits available, they shall be
zero padded to take up as many spaces as that item has been assigned.

\subsection{Path Formats}
Instalog uses several path formats across it's log output.

\subsubsection{Path Resolution}
Windows often does not provide Instalog with direct path information; providing
a full command line including arguments in some cases. Disambiguating which part
of a given command line is a path to an executable and which is part of the
arguments requires access to the filesystem of the target machine to determine.
Additionally, several APIs used by Instalog return native (NT) paths rather than
Win32 paths as a user would expect. To combat these problems, Instalog must
implement a path resolution facility.

Path resolution consists of three phases:
\begin{enumerate}
    \item Conversion from Native Path to Win32 Path
    \item Separation of the Win32 path from its arguments
    \item Removal of common path prefixes that serve as redirectors
\end{enumerate}

Instalog will use a hueristic to convert from the NT path to the Win32 path; as
there is no consistent API exposed by Windows for this task. This hueristic
consists of replacing several prefixes on the path with known values. These
replacements must be done in the following order.
\begin{enumerate}
    \item If the path begins with \verb|\|, the \verb|\| is removed.
    \item Afterwards, if the path begins with \verb|??\|, the \verb|??\| is
    removed.
    \item Afterwards, if the path begins with \verb|\?\|, then the \verb|\?\| is
    removed.
    \item Afterwards, if the path begins with \verb|globalroot\|, then
    \verb|globalroot\| is removed.
    \item Afterwards, if the path begins with \verb|system32\|, then
    \verb|system32\| is replaced with the path \verb|${WINDIR}\system32\|, where
    \var{WINDIR} is the location where Windows is installed.
    \item Finally, if the path begins with \verb|systemroot\|, then
    \verb|systemroot\| is replaced with the path to the current Windows
    installation followed by a backslash.
\end{enumerate}

After this hueristic is applied, the resulting path should correspond to a Win32
path.

The second phase consists of seperation of the executable path from it's
arguments. This is done in the same way that Windows' own \verb|CreateProcessW|
API call does. It is based on the current value of the environment variables
\verb|%PATH%| and \verb|%PATHEXT%|. The first defines to Windows where
executabs are located, while the second defines which file extensions are
allowed to be implicitly interpreted as executables.

At first, any leading space in the path is removed. Next, if the path begins
with a quote (\verb|"|) character, then the path is treated as a quoted path
that follows the same convention that Windows' own \verb|CommandLineToArgvW|
function does (see section \ref{winescape}).

Otherwise, Instalog shall try to interpret the path in terms of the portions
that end in spaces. For instance:
\begin{verbatim}
C:\Folder with .exe in the name.exe\Program.exe ProgramThatIsAnArgument.exe
         ^    ^    ^  ^   ^                    ^
\end{verbatim}
at each space point (indicated above with \verb|^|s), Instalog checks for
information about the file. If the file does not exist, each of the extensions
in \verb|%PATHEXT%| are tried, appending them to the part of the path before the
space, one by one, until a file is found that exists. If this still does not
work, Instalog shall repeat the \verb|%PATHEXT%| part of the check, prefixing
the entire path with each of the paths in \verb|%PATH%|, until it finds a match.
If it still cannot find a matching file, Instalog moves on to the next space.

For example, if \verb|PATH=C:\Windows;C:\Windows\System32|, and
\verb|%PATHEXT%=.bat;.com;.exe|, and one is trying to parse a command line of
\verb|rundll32 example.dll|, Instalog shall try the following paths, in
order:
\begin{verbatim}
rundll32
rundll32.bat
rundll32.com
rundll32.exe
C:\Windows\rundll32
C:\Windows\rundll32.bat
C:\Windows\rundll32.com
C:\Windows\rundll32.exe
C:\Windows\System32\rundll32
C:\Windows\System32\rundll32.bat
C:\Windows\System32\rundll32.com
C:\Windows\System32\rundll32.exe
rundll32 example.dll
rundll32 example.dll.bat
rundll32 example.dll.com
rundll32 example.dll.exe
C:\Windows\rundll32 example.dll
\end{verbatim}
et cetera.

Finally, common prefixes are eliminated. If after the first part of resolution,
the target is to Windows' \verb|rundll32.exe|, that part of the path is
stripped, the entire path after the first \verb|,| is stripped from the path,
and resolution is \textem{restarted} on the new argument. That is, this:
\begin{verbatim}
rundll32 baddie.dll,SomeRandomGarbage
\end{verbatim}
is (typically) resolved to
\begin{verbatim}
C:\Windows\System32\rundll32.exe
\end{verbatim}
which is Windows' Rundll32.exe. Therefore, this is stripped from the path, along
with everything after the first comma character, leaving:
\begin{verbatim}
Baddie.dll
\end{verbatim}
which may be (after resolution is re-run)
\begin{verbatim}
C:\Windows\baddie.dll
\end{verbatim}

\subsection{File Formats}
This section describes on-disk formats that are used by Instalog.

\subsubsection{Executable}
Instalog shall detect whether a file is an executable by checking the first two
bytes of the file to see if they match ``\verb|MZ|'' (\verb|0x4D| \verb|0x5A|),
which is always the first two bytes of executables Windows is capable of
loading.

\subsection{Header}
The header of an Instalog report consists of 4 lines, which are always displayed
and shown in the same order as defined in this document. No component of the
header is associated with any type of fix information.

The first line lists information about Instalog itself. It is of the form:
\begin{verbatim}
Instalog ${Version}${SafebootState}
\end{verbatim}

\var{Version} is the version number of the current release of Instalog. This
allows remote determination of cases where a user needs to upgrade their current
copy before malware removal or system repair can continue safely.

\var{SafebootState} is the string ``\verb| MINIMAL|'' if the system is currently
booted into Windows' \textit{Safe Mode}, or the string ``\verb| NETWORK|'' if
the system is booted into \textit{Safe Mode with Networking}, or nothing if the
machine was booted normally.

The second line lists information about the user running Instalog, and the local
date and time of the system when the log was generated. It has the form:
\begin{verbatim}
Run by ${UserName} at ${Date} [GMT ${TimeZone}]
\end{verbatim}

\var{UserName} is the current display name of the logged in user, escaped with
the general escaping format defined in \ref{generalescape}, using a left
delimiter of a double quote (\verb|"|), a right delimiter of a double
quote (\verb|"|), and an escape character backslash (\verb|\|).

\var{Date} is the current date when the log report was started being generated,
using the millisecond date format specified in \ref{millidate}.

\var{TimeZone} is a one sign, three digit, and one decimal point representation
of the time zone of the machine taking the report. For instance, Eastern
Standard Time is \verb|-4.00| or \verb|-5.00|, while Moscow Standard Time would
be \verb|+4.00|. (The extra two digits are to allow for locales with half and
quarter hour time zones)

The third line is designed to indicate when important exploitable applications
need to be updated, by listing their versions. It has the form:
\begin{verbatim}
IE: ${IE} Java: ${Java} Flash: ${Flash} Adobe: ${AdobeReader}
\end{verbatim}

The variables are the installed versions of Microsoft's Internet Explorer,
Oracle's Java, Adobe's Flash, and Adobe's Adobe Reader. In the event one or more
of these applications are not installed then their version is listed as
``\verb|None|''.

The fourth line contains information about the current Windows installation and
memory state. It is of the form:
\begin{verbatim}
Microsoft Windows ${WindowsVersion} ${WindowsEdition} ${ProcessorArchitecture}
${Major}.${Minor}.${Build}.${ServicePack} ${FreeRam}/${TotalRam} MB Free
\end{verbatim}

Newlines in the above are a consequence of this document and are not present in
the output.

\var{WindowsVersion} is the ``string name'' of the version of Windows in use,
such as ``XP'', ``Vista'', or ``7''. \var{WindowsEdition} is the edition of the
same; such as ``Home'', ``Professional'', or ``Ultimate''. The values
\var{Major}, \var{Minor}, \var{Build}, and \var{ServicePack} match the current
version information of the operating system in use.

\var{ProcesserArchitecture} is either the string ``\verb|x86|'' or
``\verb|x64|'', matching the installed operating system type. (Note that this is
\textit{not} the capability of the current processor)

Finally, \var{FreeRam} and \var{TotalRam} are the number of Mebibytes of memory
that are available for use by programs on the current running system.

Examples of the 4th line:
\begin{verbatim}
Microsoft Windows Vista Professional N x86 6.0.6000.0 1023/8096 MB Free
Microsoft Windows 7 Ultimate x64 6.1.7601.1 4547/8071 MB Free
\end{verbatim}

\subsection{Running Processes}
\begin{description}
\item[Rationale] \hfill \\
One obvious source of problems is the processes that are currently running on
the system.  As such, each of these processes shall be listed for analysis
purposes.  
\item[Data Sources] \hfill \\
The full path to the running executable shall be referred to as \var{path}.  The
arguments to that process shall be referred to as \var{arguments}.  The
\var{arguments} variable should be empty except if the processes is one of the
following values:
\begin{itemize}
  \item \verb|C:\WINDOWS\System32\svchost|
  \item \verb|C:\WINDOWS\System32\svchost.exe|
  %TODO: rundll?
\end{itemize}
\item[Log Format] \hfill \\
If \var{arguments} is set:
\vspace{-\baselineskip}
\begin{verbatim}
[${path} [${arguments}
\end{verbatim}
If \var{arguments} is not set:
\vspace{-\baselineskip}
\begin{verbatim}
[${path} 
\end{verbatim}
\item[Output Description] \hfill \\
Both \var{path} and \var{arguments} shall be escaped according to the scheme
described in \ref{generalescape} where \verb|#| is the escape character and
\verb|]| is the right delimiter.  
\item[Whitelist Considerations] \hfill \\
The following process paths should be whitelisted:
\begin{itemize}
  \item \verb|%WINDIR%\System32\csrss.exe|
  \item \verb|%WINDIR%\System32\winlogon.exe|
  \item \verb|%WINDIR%\System32\services.exe|
  \item \verb|%WINDIR%\System32\lsass.exe|
  \item \verb|%WINDIR%\System32\smss.exe|
\end{itemize}
\item[Fix Considerations] \hfill \\
Two fix actions shall be available:
\begin{description}
\item[Kill] This action will kill the identified process.  This action shall
accept both the process path as well as arguments.  If multiple processes exist
that match the supplied path and arguments, all instances shall be killed. 
\item[Kill and Quarantine]  This action will kill and quarantine the identified
process.  This action shall accept both the process path as well as arguments. 
The \textbf{kill} action described above shall first be followed.  The process
should then be moved into quarantine following the procedure defined in
\ref{quarantine}.  
%TODO: quarantine needs to be written.
\end{description}
\end{description}

\subsection{PseudoHJT Report} \label{hjtgeneral}
The information in the PseudoHJT report must closely match the information
displayed by the original HJT tool. The format must closely match the syntax of
a similar predecessor, DDS, so that forum volunteers need not learn
significantly different syntax to that which they know. This format is
sparse and human readable. Perhaps most importantly, despite matching the
original HJT in terms of information conveyed, the format itself MUST be
different enough to avoid legal action by TrendMicro against Instalog's authors.

Generally speaking, the PseudoHJT report shall attempt to list all relevant
loading points on a Windows machine, as well as user settings for the Internet
Explorer browser; such as home page, search provider, and title settings. The
report shall be heavily whitelisted. Items which are defaults on Windows shall
not be emitted, unless whitelisting has been disabled. Specific whitelisting
schemes are given per type of line shown in the PseudoHJT report. Instalog shall
implement the PseudoHJT report as defined in this section (\ref{hjtgeneral}).

Each line in the PseudoHJT report is given a unique prefix, which is not shared
by other line types. This allows the line to be unambiguously understood by the
Instalog GUI, and other kinds of inspection tools.

For either PseudoHJT section in the Instalog GUI, two checkboxes are available
if defined by the lines below: \textbf{Move} and \textbf{Fix} (in that order).
Move, generally speaking, will generate script to quarantine a file associated
with an entry, and Fix will generate script to reset settings to a default
state, or delete loading points.

The PseudoHJT machine report contains settings which affect the entire machine.

The PseudoHJT user report is specific to a given user on the target machine.
There will be a separate such section for each user that is loaded into the
registry at the time Instalog is run (that is, loaded into \verb|HKEY_USERS|).

The first line of the user report indicates which SID and name the user has, and
is of the form:
\begin{verbatim}
Identity: "${username}" ${sid}
\end{verbatim}

The variable \var{username} refers to the display name of the user being
enumerated. It is escaped using the general escaping method defined in
\ref{generalescape}, using a right delimiter of \verb|"|, and an escape
character of \verb|\|. The \var{sid} is the security identifier associated with
that user. It follows a regular format, and therefore need not be escaped.

\subsubsection{Root Registry Hives}
The log lines discussed in the remainder of \ref{hjtgeneral} are ``rooted'' at a
specific registry hive. Specifically, for the machine report, the root hive is
\verb|HKEY_LOCAL_MACHINE|. For a user report, this will be the root of the
user's registry, loaded under \verb|HKEY_USERS|. For instance,
\begin{verbatim}
HKEY_USERS\S-1-5-21-2812505617-3763003962-1231251036-1000
\end{verbatim}
That is, \verb|HKEY_USERS| followed by the user's SID.

The root hive of \verb|HKEY_LOCAL_MACHINE| or the user's hive shall be
the variable \var{RootHive} in the log lines below.

\subsubsection{Default Page URL}
\begin{description}
\item[Rationale] \hfill \\
The User Default Page URL is the location(s) of pages opened when a user creates
a new Microsoft Internet Explorer window, or starts the browser for the first
time. 
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Default_Page_URL"="${url}"
; 64 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Default_Page_URL"="${url64}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
DefaultPageUrl=${url}
DefaultPageUrl64=${url64}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} and \var{url64} are escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
\input{snippets/iewhitelist.tex}
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It generates script setting the value
``\verb|Default_Page_URL|'' to ``\verb|http://google.com/|''.
\end{description}

\subsubsection{Default Search URL}
\begin{description}
\item[Rationale]  \hfill \\ The default search URL is used to redirect the user
to a specific web search site if they type an invalid URL.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Default_Search_URL"="${url}"
; 64 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Default_Search_URL"="${url64}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
DefaultSearchUrl=${url}
DefaultSearchUrl64=${url64}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} and \var{url64} are escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
\input{snippets/iewhitelist.tex}
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It generates script setting the value
``\verb|Default_Search_URL|'' to ``\verb|http://google.com/|''.
\end{description}

\subsubsection{Local Page URL}
\begin{description}
\item[Rationale]  \hfill \\ The local URL is shown as the "blank" page in
Internet Explorer.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Local Page"="${url}"
; 64 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Local Page"="${url64}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
LocalPage=${url}
LocalPage64=${url64}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} and \var{url64} are escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
On x86 versions of Windows, \var{url64} does not exist, and the default value of
\var{url} is \verb|%WINDIR%\System32\Blank.htm|, which shall not be displayed.
On x64 versions of Windows, the default value of \var{url64} is
\verb|%WINDIR%\System32\Blank.htm|, and the default value of \var{url} is
\verb|%WINDIR%\SysWow64\Blank.htm|, neither of which shall be displayed.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It generates script resetting the default
value for the machine type which generated the log.
\end{description}

\subsubsection{Start Page URL}
\begin{description}
\item[Rationale]  \hfill \\ This setting corresponds to Internet Explorer's home
page.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Start Page"="${url}"
; 64 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Start Page"="${url64}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
StartPage=${url}
StartPage64=${url64}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} and \var{url64} are escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
\input{snippets/iewhitelist.tex}
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It generates script setting the start page to
Google.
\end{description}

\subsubsection{Search Page URL}
\begin{description}
\item[Rationale] \hfill \\ This is a legacy setting which specifies the URL to
open if the user selects Start $\rightarrow$ Find $\rightarrow$ On The Internet.
(It is enumerated primarily because other tools do)
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Search Page"="${url}"
; 64 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Search Page"="${url64}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
SearchPage=${url}
SearchPage64=${url64}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} and \var{url64} are escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
\input{snippets/iewhitelist.tex}
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It generates script setting the value
``\verb|Search Page|'' to Google.
\end{description}

\subsubsection{Search Bar}
\begin{description}
\item[Rationale]  \hfill \\ It is suspected that this value contains information
about the search bar used in Internet Explorer versions 7 and 8. (It is
enumerated primarily because other tools do)
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Search Bar"="${url}"
; 64 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Search Bar"="${url64}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
SearchBar=${url}
SearchBar64=${url64}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} and \var{url64} are escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
\input{snippets/iewhitelist.tex}
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which resets this
value to the default setting.
\end{description}

\subsubsection{Search Migrated Default URL}
\begin{description}
\item[Rationale]  \hfill \\ This value contains migrated search URL settings.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"SearchMigratedDefaultUrl"="${url}"
; 64 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"SearchMigratedDefaultUrl"="${url64}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
SearchMigratedDefaultUrl=${url}
SearchMigratedDefaultUrl64=${url64}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} and \var{url64} are escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
\input{snippets/iewhitelist.tex}
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the value.
\end{description}

\subsubsection{Security Risk URL}
\begin{description}
\item[Rationale]  \hfill \\ This value contains the URL used to warn users about
potential security faults with a particular website.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Security Risk Page"="${url}"
; 64 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Security Risk Page"="${url64}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
SecurityPage=${url}
SecurityPage64=${url64}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} and \var{url64} are escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
The default setting for both variables is ``\verb|about:SecurityRisk|''. This
line will not be generated if that default setting is set.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which resets the
``\verb|Security Risk Page|'' value to the default.
\end{description}

\subsubsection{Internet Explorer Window Title}
\begin{description}
\item[Rationale]  \hfill \\ This value is used to allow OEMs to customize their
versions of Internet Explorer, such as making the title say ``Microsoft Internet
Explorer provided by Timer Warner Cable''.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Window Title"="${title}"
; 64 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"Window Title"="${title64}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
WindowTitle=${title}
WindowTitle64=${title64}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{title} and \var{title64} are escaped using the general
escaping method defined in \ref{generalescape}, using an escape character of
the hash mark (\verb|#|).
\item[Whitelist Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the
``\verb|WindowTitle|'' value.
\end{description}

\subsubsection{Search URL}
\begin{description}
\item[Rationale] \hfill \\
The URL to use when the user types something into the address bar that isn't
an address, for example: \verb|http://google.com/search?q=%s| where \verb|%s|
is filled by the user's query.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"SearchURL"="${url}"
; 64 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer]
"SearchURL"="${url64}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
SearchUrl=${url}
SearchUrl64=${url64}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} and \var{url64} are escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the value
in question.
\end{description}

\subsubsection{Search Assistant}
\begin{description}
\item[Rationale] \hfill \\
This is the value used to display a search engine in the search page when the
user selects ``Search'' from Internet Explorer's toolbar.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer\Search]
"SearchAssistant"="${url}"
; 64 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer\Search]
"SearchAssistant"="${url64}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
SearchAssistant=${url}
SearchAssistant64=${url64}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} and \var{url64} are escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the value
in question.
\end{description}

\subsubsection{Customize Search}
\begin{description}
\item[Rationale] \hfill \\
Unknown, but HijackThis and DDS enumerate it.
\input{snippets/ie64bit.tex}
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer\Search]
"CustomizeSearch"="${url}"
; 64 Bit Registry View
[${RootHive}\Software\Microsoft\Internet Explorer\Search]
"CustomizeSearch"="${url64}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
CustomizeSearch=${url}
CustomizeSearch64=${url64}
\end{verbatim}
\item[Output Description] \hfill \\
The variables \var{url} and \var{url64} are escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the value
in question.
\end{description}

\subsubsection{User Only Sections}
The following sections are displayed in user PseudoHJT reports only.

\subsubsection{Internet Connection Wizard Shell Next}
\begin{description}
\item[Rationale] \hfill \\
This is the location a user is dropped to after completing the Internet
Connection Wizard.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Internet Connection Wizard]
"ShellNext"="${url}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|InternetConnectionWizard=${url}|
\item[Output Description] \hfill \\
The variables \var{url} and \var{url64} are escaped using the URL escaping
scheme defined in \ref{urlescape}, where the escape character is the hash mark
(\verb|#|).
\item[Whitelist Considerations] \hfill \\
This value is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the
``\verb|ShellNext|'' value above.
\end{description}

\subsubsection{Proxy Server}
\begin{description}
\item[Rationale] \hfill \\
The proxy server configured for the user; through which all Internet traffic is
directed.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\Internet Settings]
"ProxyServer"="${proxy}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|ProxyServer=${proxy}|
\item[Output Description] \hfill \\
The variable \var{proxy} is escaped using the general escaping method defined in
\ref{generalescape}, using the escape character \verb|#|.
\item[Whitelist Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the
``\verb|ProxyServer|'' value above.
\end{description}

\subsubsection{Proxy Override}
\begin{description}
\item[Rationale] \hfill \\
A setting which overrides the proxy server setting; addresses configured here
bypass the proxy server and go directly to the default gateway.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
[${RootHive}\Software\Microsoft\Windows\CurrentVersion\Internet Settings]
"ProxyOverride"="${override}"
\end{verbatim}
\item[Log Format] \hfill \\
\verb|ProxyOverride=${override}|
\item[Output Description] \hfill \\
The variable \var{override} is escaped using the general escaping method defined
in \ref{generalescape}, using the escape character \verb|#|.
\item[Whitelist Considerations] \hfill \\
This entry is not whitelisted.
\item[Fix Considerations] \hfill \\
The only valid option is ``Fix''. It shall generate a fix which erases the
``\verb|ProxyOverride|'' value above.
\end{description}

\subsection{Mozilla Firefox}
Mozilla Firefox (hereafter referred to as simply ``Firefox'') is a popular web
browser that many users have installed on their machines.  An attack from within
the browser is a possibility.  As such, this tool must enumerate various Firefox
loading points to find suspicious information (if Firefox is installed).  This
can be determined by checking to see if the \var{version} is set in the
following registry key:
% TODO: Do I have to put any 32/64 bit information here? 
\begin{verbatim}
[HKEY_LOCAL_MACHINE\SOFTWARE\Mozilla\Mozilla Firefox] 
"Current Version"="${version}
\end{verbatim}

If Firefox is installed, the following information shall be output to the log. 
If Firefox is not installed, the entire section shall not be printed to the log.

This specification is targeted for Firefox 10.0 x86 builds.  The behavior is
undefined for other versions of Firefox but will likely be similar.

\subsubsection{Profile}
\begin{description}
\item[Rationale] \hfill \\
Firefox stores its user settings in ``profiles''.  Each profile is a directory
on disk.  
\item[Data Sources] \hfill \\
The profiles are stored in the following location:
\vspace{-\baselineskip}
\begin{verbatim}
%APPDATA%\Roaming\Mozilla\Firefox\Profiles\${profilefolder}
\end{verbatim}
There can be several profiles installed for each user.   All profiles in this
directory with randomly generated folder names of 8 characters.  The profile
that starts up when Firefox loads will be in the randomly named folder appended
by ``\verb|.default|''.  It shall be sufficient to only enumerate the default
profile for the currently logged in user.
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
ProfilePath ${profilefolder}
\end{verbatim}
\item[Output Description] \hfill \\
\var{profilefolder} shall be escaped using the scheme described in
\ref{generalescape}, where the escape character is the hash mark (\verb|#|) and
the right delimiter is just the newline.
\item[Whitelist Considerations] \hfill \\
This item cannot be whitelisted as it is unique to each user's machine.
\item[Fix Considerations] \hfill \\
There are no fix actions associated with the profile path.  The profile path is
provided so that further fix actions can be applied to components within the
path.
\end{description}

\subsubsection{User Preferences}
\begin{description}
\item[Rationale] \hfill \\
Some user preferences could be overridden that would lead a user to malicious
pages.  
\item[Data Sources] \hfill \\
User preferences are located in the ``\verb|${profile path}/prefs.js|'' file. 
The preferences are saved in the JSON format. There are several different
``loading points'' from this file that could be important for diagnosing an
infection:
\begin{itemize}
  \item \verb|browser.startup.homepage|
  \item \verb|network.proxy.type|
\end{itemize}
The name of the preference will be referred to as \var{preference} and the
value to which that preference is set as \var{value}.  If a preference does not
have a name, \var{value} shall default to ``not set''.
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
${preference}=${value}
\end{verbatim}
This line shall be printed for every \var{preference} listed in Data Sources.
\item[Output Description] \hfill \\
\var{value} must be escaped using the URL escaping scheme defined in
\ref{urlescape}, where the escape character is the hash mark (\verb|#|).
\item[Whitelist Considerations] \hfill \\
The default values for each preference shall be whitelisted.  These values are
enumerated below:
\begin{enumerate}
  \item \verb|browser.startup.homepage = about:home|
  \item \verb|network.proxy.type = 5|
\end{enumerate}

\item[Fix Considerations] \hfill \\
A sensible fix for these items is to simply delete the corresponding key and
value from \verb|prefs.js|.  Firefox will then reset the preference to the
default value the next time it loads.

Firefox must not be running for this to work.  If a script is supposed to fix
any of the preferences and Firefox is running, a dialog must appear warning the
user that Firefox will be closed.  When the user hits okay in this dialog, the
Firefox process can be killed if it is still running and the preference(s)
reset.
\end{description}

\subsubsection{Extensions}
\begin{description}
\item[Rationale] \hfill \\
Firefox allows users to add to the functionality of their browser through
``extensions'' (sometimes called addons).  These extensions can be malicious in
nature.  Extensions need not be installed by the user; they can be installed
outside Firefox as well by placing extensions in the profile directory and
relaunching Firefox.  
\item[Data Sources] \hfill \\
Extension metadata is stored in an SQLite 3 database located in \\
\verb|${profilepath}/extensions.sqlite|.  There are two tables in this database
that are of interest: \verb|addon| and \verb|locale|. 
 
The output variables are defined as:
\begin{description}
  \item[\var{visible}] \verb|addon.visible| attribute.  This shall be output as
  a binary 0 or 1 value.
  \item[\var{active}] \verb|addon.active| attribute.  This shall be output as a
  binary 0 or 1 value.
  \item[\var{name}] \verb|locale.name| attribute where \texttt{locale.id =
  addon.defaultLocale}
  \item[\var{version}] \verb|addon.version| attribute
  \item[\var{type}] \verb|addon.type| attribute
  \item[\var{id}] \verb|addon.id| attribute
  \item[\var{path}] \verb|addon.descriptor| attribute
\end{description}
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
Extension ${visible} ${active} "${name} ${version} ${type} ${id} ${path}
\end{verbatim}
\item[Output Description] \hfill \\
\var{name} shall be escaped according to the scheme defined in
\ref{generalescape} with \verb|#| as the escape character and double quotes
(\verb|"|) as the right delimiter.  \var{path} shall be escaped according to
the scheme defined in \ref{generalescape} with \# as the escape character and
the newline as the right delimiter.
  
\item[Whitelist Considerations] \hfill \\
No whitelist actions apply here
\item[Fix Considerations] \hfill \\
To fix these items, the \var{path} simply needs to be deleted.  This must
happen while Firefox is not running.  If a script is supposed to fix an
extension and Firefox is running, a dialog must appear warning the user that
Firefox will be closed.  When the user hits okay in this dialog, the Firefox
process can be killed if it is still running.  When the user re-opens Firefox
later, the extension(s) will be removed from the database.
\end{description}

\subsubsection{Plugins}
\begin{description}
\item[Rationale] \hfill \\
Firefox, like most major browsers, supports plugins.  These are a potential
attack vector and shall be scanned.  
\item[Data Sources] \hfill \\
Firefox maintains a list of plugins in \texttt{\var{profilepath}/pluginreg.dat}.
This file is structured in a specific way.  Everything below the line labeled
``\texttt{[PLUGINS]}'' is imported for this tool.  Each plugin is listed below
this line, each in its own ``block''.  These ``block'' are all structured
similarly, and follow the same format:
\begin{verbatim}
${file name}|$
${full file path}|$
${version}|$
${installed timestamp}|${unknown?}|${unknown?}|$
${description}|$
${name}|$
${mime type count}
0|${mime type}|$
1|${mime type}|$
...
${${mime type count} minus 1}|${mime type}|$
\end{verbatim}
Each plugin ``block'' is put immediately after the last plugin ``block'' with no
other separation.  It shall be enough to read through to the
``\texttt{[PLUGINS]}'' line and keep parsing ``block'' until the
``\texttt{[INVALID]}'' line is reached.
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
Plugin "${name} ${version} ${path}
\end{verbatim}
\item[Output Description] \hfill \\
\var{name} shall be escaped according to the scheme
defined in \ref{generalescape} with \verb|#| as the escape character and double
quotes (\verb|"|) as the right delimiter.  \var{path} shall be escaped
according to \ref{generalescape} as well with \verb|#| as the escape character
and the newline as the right delimiter.  
\item[Whitelist Considerations] \hfill \\
No whitelist actions are necessary.  
\item[Fix Considerations] \hfill \\
To fix these items, the \var{path} simply needs to be deleted.  This must
happen while Firefox is not running.  If a script is supposed to fix an
plugin and Firefox is running, a dialog must appear warning the user that
Firefox will be closed.  When the user hits okay in this dialog, the Firefox
process can be killed if it is still running.  When the user re-opens Firefox
later, the plugins(s) will be removed from the file.
\end{description}

\subsection{Google Chrome}
Google Chrome (hereafter referred to as ``Chrome'') is a popular browser that is
extensible like Firefox.  Therefore, like Firefox, it has some potential attack
vectors.  This section of the log shall only appear if Chrome is installed.  To
determine if Chrome is installed for the current user, the tool shall check to
see if the \texttt{Chrome.exe} executable exists in the following path:
\begin{verbatim}
%userprofile%\AppData\Local\Google\chrome.exe
\end{verbatim}

If Chrome is installed, the following information shall be output to the log. 
If Chrome is not installed, the entire section shall not be printed to the log.
%TODO: multipe users

This specification is targetted at Chrome 17.0.  While this information extend
to other versions of the browser, the behavior will be undefined.  

All of the various sections for Chrome pull from the same Preferences file:
\begin{verbatim}
%userprofile%\AppData\Local\Google\Chrome\User Data\Default\Preferences
\end{verbatim}
This is a JSON file that contains most of the important settings for a user.  In
this document, to address JSON locations, the successive keys of each object
will be given.  For example, if the JSON file were:
\begin{verbatim}
{
    "a": {
        "one": true,
        "two": false,
        "three": {
            "i": "stringvalue"
        }
    }
    "b": 1234
}
\end{verbatim}
In this case, simply stating ``\texttt{a}'' would refer to the ``\texttt{a}''
object and all of its children.  Similarly, ``\texttt{a.three}'' would refer to
the ``\texttt{three}'' object in the ``\texttt{a}'' object.  To access values,
a full key shall be given (``\texttt{a.one}'', ``\texttt{a.two}'',
``\texttt{a.three.i}'', or ``\texttt{b}'').  

A ``\texttt{*}'' indicates that any string can be used and will return a set of
objects that match the specified string.  For example, ``\texttt{a.*}'' would
return ``\texttt{a.one}'', ``\texttt{a.two}'', and ``\texttt{a.three}'' and
``\texttt{a.*.i}'' would return ``\texttt{a.three.i}.

\subsubsection{Extensions}
\begin{description}
\item[Rationale] \hfill \\
Chrome allows users to add to the functionality of their browser through
``extensions'' (sometimes called addons).  These extensions can be malicious in
nature.   Each extension is installed into its own randomly named folder inside
\vspace{-\baselineskip}
\begin{verbatim}
%userprofile%\AppData\Local\Google\Chrome\User Data\Default\Extensions\
\end{verbatim}
\item[Data Sources] \hfill \\
All of the data for the extensions is available in the aforementioned
Preferences file.  Each extension has its own object created inside
\texttt{extensions.settings}.  Therefore, each extension can be enumerated by
listing the set of \texttt{extensions.settings.*}.  For each extension in this
set (hereafter referred to as \texttt{e}), the following variables are defined:
\begin{description}
\item[\var{state}] \texttt{e.state}
\item[\var{name}] \texttt{e.mainfest.name}
\item[\var{version}] \texttt{e.manifest.version}
\item[\var{id}] The object key of \texttt{e}
\end{description}
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
Extension ${state} "${name} ${version} ${id}
\end{verbatim}
\item[Output Description] \hfill \\
\var{name} shall be escaped according to \ref{generalescape} with an escape
character of \verb|#| and a right delimiter of double quotes (\verb|"|). 

\item[Whitelist Considerations] \hfill \\
A default Chrome installation has several safe extensions installed.  Extensions
shall be whitelisted if their \var{name} matches any of the following
extensions:
\begin{itemize}
\item ``YouTube''
\item ``Google Search''
\item ``Gmail''
\end{itemize}
\item[Fix Considerations] \hfill \\
To remove a Chrome extensions, two actions must be taken.  First, the entire
extension object must be removed from the Preferences file for the given
extension \var{id}.  Secondly, the extension must be removed from the
filesystem.  This can be achieved by deleting the directory 
\vspace{-\baselineskip}
\begin{verbatim}
%userprofile%\AppData\Local\Google\Chrome\User Data\Default\Extensions\${id}
\end{verbatim}

Chrome must not be running for this operation to proceed.  If Chrome is running,
a dialog must appear warning the user that Chrome will be closed.  When the
user hits okay in this dialog, the Chrome process can be killed if it is still
running.  
\end{description}

\subsubsection{Plugins}
\begin{description}
\item[Rationale] \hfill \\
Chrome, like most major browsers, supports plugins.  These are a potential
attack vector and shall be scanned.
\item[Data Sources] \hfill \\
The list of plugins is available in the Preferences file.  Each plugin is listed
inside a JSON list located in \verb|plugins.plugins_list|.  For each plugin,
\texttt{p} in this list, the following variables are defined:
\begin{description}
\item[\var{name}] \texttt{p.name}
\item[\var{version}] \texttt{p.version}
\item[\var{path}] \texttt{p.path}
\end{description}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
Plugin "${name} ${version} ${path}
\end{verbatim}
\item[Output Description] \hfill \\
\var{name} shall be escaped according to the scheme defined in
\ref{generalescape} with \verb|#| as the escape character and double quotes
(\verb|"|) as the right delimiter.  \var{path} shall be escaped according to
\ref{generalescape} as well with \verb|#| as the escape character and the
newline as the right delimiter.
\item[Whitelist Considerations] \hfill \\
Default Chrome installations have several plugins pre-installed.  If \var{name}
matches any of the following values, the plugin can be whitelisted:
\begin{enumerate}
  \item ``Shockwave Flash''
  \item ``Flash''
  \item ``Remoting Viewer''
  \item ``Native Client''
  \item ``Chrome PDF Viewer''
\end{enumerate}
\item[Fix Considerations] \hfill \\
To fix these items, the \var{path} simply needs to be deleted.  This must
happen while Chrome is not running.  If a script is supposed to fix an
plugin and Chrome is running, a dialog must appear warning the user that
Chrome will be closed.  When the user hits okay in this dialog, the Chrome
process can be killed if it is still running.  
\end{description}

\subsubsection{Other user preferences}
\begin{description}
\item[Rationale] \hfill \\
Some other user preferences, such as homepages and such could become infected by
malware.  Therefore, these preferences shall be scanned.
\item[Data Sources] \hfill \\
Each of the preferences comes from the Preferences file.  The following
preferences shall be enumerated:
\begin{itemize}
  \item \verb|default_search_provider.search_url|
  \item \verb|homepage|  
\end{itemize}
The name of the preference shall be referred to as \var{name} and the
corresponding value as \var{value}.  If no value is available, \var{value}
shall be set to ``not set''.
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
Preference ${name} ${value}
\end{verbatim}
This line shall be printed for each preference listed in the Data Sources.
\item[Output Description] \hfill \\
\var{value} must be escaped using the URL escaping scheme defined in
\ref{urlescape}, where the escape character is the hash mark (\verb|#|).
\item[Whitelist Considerations] \hfill \\
If the \var{name} is \verb|default_search_provider.search_url|, then the default
value is:
\vspace{-\baselineskip}
\begin{verbatim}
"{google:baseURL}search?{google:RLZ}{google:acceptedSuggestion}{google:
originalQueryForSuggestion}{google:searchFieldtrialParameter}{google:
instantFieldTrialGroupParameter}sourceid=chrome&ie={inputEncoding}&q=
{searchTerms}"
\end{verbatim}
without the newlines.  This value could potentially be whitelisted.  
\item[Fix Considerations] \hfill \\
To fix these items, it is enough to simply delete the object in the Preferences
file with the given \var{name}.  This must happen while Chrome is not running. 
If a script is supposed to fix a preference and Chrome is running, a dialog must
appear warning the user that Chrome will be closed.  When the user hits okay in
this dialog, the Chrome process can be killed if it is still running.
\end{description}

\subsection{Services/Drivers}
%Bill
\subsection{Created Last 30}
%Bill
\subsection{Find3M}
%Bill
\subsection{Event Viewer}
The event viewer section shall enumerate event viewer messages from the past
week. Each line of this report shall match
\begin{verbatim}
${Date}, ${Type}: ${Source} [${EventId}] ${Description}
\end{verbatim}
where \var{Date} is the date the event was logged using the standard date format
(see section \ref{stddate}), \var{type} is the type of event log message
(currently ``Critical'', ``Error'', ``Warning'', or ``Information''),
\var{Source} is the service that generated the event log, \var{EventId} is the
ID that service has given the event, and \var{Description} is the human readable
description provided by the service.

All ``Warning'' and ``Critical'' messages will be printed to the log, from the
default System and Application event logs. All messages (including
Informational and Warning) will be enumerated for Windows File Protection
sourced events.

The EventIds 1000, 8023, and 10010 are whitelisted, and shall not be printed.

\subsection{Machine Specifications}
\begin{description}
\item[Rationale] \hfill \\
Sometimes it is helpful for a forum assistant to have an idea of what type of
machine the end user is working on.  This section's purpose is to provide this
type of information.
\item[Data Sources] \hfill \\
This segment is generated primarily from the \verb|Win32_ComputerSystem| class
in Windows Managment Instrumentation.
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
${windows_version}
Boot Device: ${boot_device}
Install Date: ${install_date}
System Uptime: ${uptime} (${uptime_duration})
Motherboard: ${motherboard}
Processor: ${processor_0}
${drive_partitions}
\end{verbatim}
\var{drive\_partitions} is defined as a list of all of the drive partitions
on the system.  This list should list each partition on its own line.  There are
two different types of lines that are possible.  If the partition's size is not
available, the following line shall be printed:
\vspace{-\baselineskip}
\begin{verbatim}
${partition_letter}: is ${type}
\end{verbatim}
\var{partition\_letter} is simply the letter of the partition.  \var{type} is
the type of the disk (``FIXED", ``CDROM", or ``REMOVABLE'').  If the size is
available, the following line shall be printed:
\vspace{-\baselineskip}
\begin{verbatim}
${partition_letter}: is ${type} - ${total} GiB total, ${free} GiB free
\end{verbatim}
\var{total} is the total size of the disk and \var{free} is the free space
remaining on the disk.  Both of these values shall be reported in Gibibytes
(Giga Binary Bytes, 1 GiB = 1,073,741,824 bytes).

\item[Output Description] \hfill \\
None of the variables need to be escaped.
\item[Whitelist Considerations] \hfill \\
There are no applicable whitelist considerations.
\item[Fix Considerations] \hfill \\
No applicable fix considerations apply.  
\end{description}

\subsection{Restore Points}
\begin{description}
\item[Rationale] \hfill \\
Restore Points were introduced in Windows XP.  They allow a user to return their
system to a previous state.  These restore points are typically created when a
major system event occurs (application installs / uninstalls), driver changes,
etc.  Users can also manually create restore points. 

If there are no restore points available or the system does not support restore
points, this entire log section shall be skipped.
\item[Data Sources] \hfill \\
Restore Points can be accessed using WMI
(\url{http://msdn.microsoft.com/en-us/library/windows/desktop/aa378951.aspx}),
which exposes a list of \texttt{SystemRestore} classes:
\vspace{-\baselineskip}
\begin{verbatim}
class SystemRestore
{
  String Description;
  uint32 RestorePointType;
  uint32 EventType;
  uint32 SequenceNumber;
  String CreationTime;
};
\end{verbatim}
From this class, the variables that shall be logged are \texttt{Description},
\texttt{SequenceNumber}, and \texttt{CreationTime} and will be referred to as
\var{description}, \var{number}, and \var{time} respectively.
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
${number} ${time} ${description}
\end{verbatim}
\item[Output Description] \hfill \\
None of the variables need to be escaped.
\item[Whitelist Considerations] \hfill \\
There are no applicable whitelist considerations.
\item[Fix Considerations] \hfill \\
No applicable fix considerations apply.  Future versions of this tool may
support restoring to a certain point.  
\end{description}

\subsection{Installed Programs}
\begin{description}
\item[Rationale] \hfill \\
It is often important to have a full list of which programs are installed on a
user machine.  The output log shall contain a list of all installed programs.  
\item[Data Sources] \hfill \\
The installed programs shall be determined by enumerating through the registry
for all of the \var{id}'s that are present.
\vspace{-\baselineskip}
\begin{verbatim}
[HKEY_LOCAL_MACHINE\Software\Microsoft\CurrentVersion\Uninstall\${id}]
"DisplayName"="${name}"
"VersionMajor"="${version_major}"
"VersionMinor"="${verison_minor}"
\end{verbatim}
\item[Log Format] \hfill 
\vspace{-\baselineskip}
\begin{verbatim}
${name} version ${version_major}.${version_minor}
\end{verbatim}
\item[Output Description] \hfill \\
None of the variables need to be escaped.
\item[Whitelist Considerations] \hfill \\
There are no applicable whitelist considerations.
\item[Fix Considerations] \hfill \\
No applicable fix considerations apply.  Future versions of this tool may
support uninstalling.  However, since some applications use non-standard
uninstallers, support uninstalling across the board could prove difficult.
\end{description}

\subsection{Footer}
The footer shall not have a section title. It is a line of the following form
surrounded by newlines:
\begin{verbatim}
Instalog ${version} Finished ${Date}
\end{verbatim}

Here, \var{version} is the version of Instalog used to generate the report, and
\var{Date} is the date when the report was completed using the millisecond date
format defined in section \ref{millidate}.

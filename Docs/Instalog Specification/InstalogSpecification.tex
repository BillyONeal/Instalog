%%This is a very basic article template.
%%There is just one section and two subsections.
\documentclass[letterpaper,12pt]{article}
\usepackage[margin=1in]{geometry}
\usepackage{xltxtra}
\setmainfont[Mapping=tex-text]{Liberation Serif}
\setmonofont[Scale=0.8]{Liberation Mono}
\newcommand{\var}[1]{\texttt{\$\{#1\}}}
\usepackage[colorlinks=false,pdfborder=0 0 0]{hyperref}

\title{Instalog Requirements Specification}
\author{
Billy R. O'Neal III (bro4@case.edu) \\
Jacob Snyder (jrs213@case.edu)
}

\begin{document}

\maketitle

\section{Introduction}
Instalog is a senior project by Jacob Snyder and Billy O'Neal, which is designed
to gather information from Microsoft Windows installations, for the purpose of
malware removal and system repair.  It must generate a human and machine
readable report which assists end users, remote experts, and local
administrators with issue diagnosis and malware removal.

Instalog is inspired by several similar tools which all share some basic
functionality.  In many ways, Instalog can be viewed as an evolution of
these tools:
\begin{itemize}
    \item TrendMicro's {\em Hijack This} (HJT)
    \item ``sUBs'' {\em Doesn't Do Squat} (DDS)
    \item ``random/random'''s {\em Random's System Information Tool} (RSIT)
    \item ``OldTimer'''s {\em OTA}, {\em OTS}, and {\em OTL} (formerly
    OTAnalyzeIt, OTScanIt, and OTListIt, respectively)
    \item Sysinternals' {\em Autoruns}
    \item Runscanner's {\em Runscanner}
\end{itemize}
all of which purport to accomplish similar goals to Instalog. However, each of
these tools has bugs or specific behavior which cause problems for at least one
of Instalog's three intended user groups.

Specifically, the above tools contain one or more of the above problems:
\begin{itemize}
    \item Incorrect handling and escaping of log data
    \item Lack of published specifications, documentation, or source code
    \item Outstanding bugs that the authors are unwilling or unable to fix
    \item Lack of scriptability, for the purposes of modifying log output and
    malware removal.
    \item Lack of 64 bit support.
    \item Lack of Unicode support.
    \item Lack of enumeration of some types of useful log information.
\end{itemize}
Instalog will attempt to solve those problems by combining characteristics of
the above tools which are deemed useful, while mixing in a few tricks of it's
own.

\subsection{Document Conventions}
Within the scope of this document, computer output or other information that is
to be taken literally is written in \texttt{fixed width text}. In some
instances, a block of fixed width text will be surrouned by non-fixed width
quotes ``\texttt{ like this}''. In such cases, the quotes are not significant,
and there will there will (typically) be leading or trailing space around the
fixed width block, which is significant and MUST NOT be removed. Variables,
which are replaced with some content, are written of the form \var{name}, and
will be explained in greater detail in prose surrounding a given block of
\texttt{fixed width} text.

\subsection{Intended Audience}
Instalog is designed with three types of target users in mind. These ``user
classes'' are listed in the following sections.

\subsubsection{Home Users}
For a typical home user, Instalog MUST NOT display a complicated interface, and
must make it relatively difficult to misstep and take a wrong action. Few
options need be presented, such as the ability to generate a default report and
the ability to take a given script and run it on a target machine. Complicated
features such as analysis MUST NOT be displayed; though they may appear as
options that are, by default, deselected.

\subsubsection{Administrators}
Administrators are similar to home users in that they are physically working at
a computer being examined, but they are different in that they have the inten of
repairing their own computer or the computer of a client. They wish to see
analysis features and more possible options. Instalog MUST provide a means for
Administrators to use it's analysis features without manual saving and reloading
of log files.

\subsubsection{Forum Experts}
Forum Experts help typical end users repair their machines remotely over
self-help forums such as BleepingComputer.com or GeeksToGo.com.
These users work remotely, and likely will never see a given target
machine.
Instalog MUST produce log formats that are human readable in the vast majority
of cases, but which can be passed through common forum software such as Invision
Power Board, phpBB, or vBulletin without destruction of information.
Unforunately, this makes common data exchange formats such as JSON and XML
unsuitable. 

Moreover, as obtaining additional information from a machine may
have lead times of several days, Instalog's report must be unambiguous; that is,
no two possible system configurations may produce the same output. Experts can
also benefit from log analysis features. Finally, Experts need to be able to
write simple, human readable scripts to perform actions to fix a user's machine
remotely.

\subsection{Acknowledgements}
Instalog's authors would like to thank ``sUBs'' for use of DDS's whitelisting
data for use in Instalog, and for being available for occasonal clarification
of problems. He also allowed use of a modified form of DDS' logging format.

Instalog also was constructed with feedback taken from self help forums like
BleepingComputer, and students in Dr. Glutekin Özsoyoğlu's EECS 395: Senior
Project class of Spring 2012, at Case Western Reserve University.

\subsection{Licensing}
Instalog itself is to be released under the two clause form of the BSD license,
which is reprinted below:

\begin{verbatim}
Copyright © 2012, Jacob Snyder, Billy O'Neal III, and "sUBs"
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met: 

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer. 
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution. 

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
\end{verbatim}

This document, along with all other documentation related to Instalog,  is to be
released under the Creative Commons Attrribution 3.0 Unported license. Human
readable and lawyer readable versions of this license can be found at
\url{http://creativecommons.org/licenses/by/3.0/}.

\subsection{Minimum System Requirements}
Instalog MUST run on all Microsoft Windows NT variants released later than
Windows 2000 (x86, SP4 only). This includes all versions Windows XP (x86 and
x64, RTM, SP1, SP2, and SP3 (on x86 machines)), Windows Vista (x86 and x64, RTM,
SP1, and SP2), Windows 7 (x86 and x64, RTM and SP1), Windows Server 2003 (x86
and x64, RTM, SP1, and SP2), Windows Server 2003 R2 (x86 and x64, RTM, SP1, and
SP2), Windows Server 2008 (x86 and x64, RTM, SP1, and SP2), Windows Server 2008
R2 (x64, RTM, and SP1).

No attempt will be made to support Itanium architecture systems as Instalog's
authors do not have access to suitable testing hardware. No attempt will be made
to support MS-DOS based versions of Windows. Instalog's behavior on unsupported
machines must not cause data destruction, but is otherwise undefined.

\section{Grapherical User Interface}
\section{Log Output}
This section generally defines the form of Instalog's output. A log is split up
into several delimited portions called ``sections''. With the exception of
headers and footers, all sections begin with a line similar to the following
format:

\begin{verbatim}
================ ${Section Name} ===============
\end{verbatim}

That is, the name of the section with one space of padding, centered in a block
of equals (\verb|=|) signs 50 total characters wide. In the case that a tie
exists with respect to the centering, Instalog shall prefer placing the name of the
section farther to the right than to the left.

Instalog's standard (that is, run without a script) output consists of the
following sections in the following order:
\begin{enumerate}
    \item Header
    \item Running Processes
    \item Machine PsuedoHJT Report
    \item $n$ User PseudoHJT Reports (One for each loaded user registry on the
    system)
    \item Mozilla Firefox (If Mozilla Firefox is installed)
    \item Google Chrome (If Google Chrome is installed)
    \item Created Last 30
    \item Find3M Report
    \item Event Viewer (If any relevant events need be reported)
    \item Machine Specifications
    \item Restore Points
    \item Installed Programs
    \item Footer
\end{enumerate}

\noindent{}The following additional sections are available but they are not
generated in the default report:
\begin{description}
\item[DNS Check] Displayed if the \verb|:dnscheck| scripting section is used.
\item[Directory] Displayed if the \verb|:dirlook| scripting section is used.
\item[VirusTotal] Displayed if the \verb|:virustotal| scripting section is used.
\item[MRC Upload] Displayed if the \verb|:mrc| scripting section is used.
\item[Process Kill] Displayed if the \verb|:kill| scripting section is used.
\item[File Quarentine] Displayed if the \verb|:move| scripting section is used.
\item[Security Center] Displayed if the \verb|:securitycenter| scripting section
is used.
\item[Registry 32 Bit] Displayed if the \verb|:reg32| scripting action is used.
\item[Registry 64 Bit] Displayed if the \verb|:reg64| scripting action is used.
\end{description}

\subsection{Escaping Formats}
In order to meet the requirements of machine readability and human readability,
several escaping formats must be used depending on the type of data to produce
the most readable unambigous representation given typical data collected from a
given location.

\subsubsection{General Escaping Format}
Generally, escaping MUST be done in a manner similar to most programming
languages, such as C, C++, Java, or similar, for quoted string escapes. Such an
escaping scheme is defined by three characters: an optional starting delimiter,
an optional termination delimiter, and an escape character. For instance, in C,
the starting delimiter is the quote mark, \verb|"|, the ending delimiter is also a quote
mark \verb|"|, and the escape character is the backslash \verb|\|.

For most types of information Instalog enumerates, such as Windows file paths,
the exact method C uses is unsuitable; backslashes occur far too often inside
file paths for the backslash as an escape character to make a good choice.
Legacy applications like the command processor (\texttt{cmd.exe}) get around
such problems by implementing complicated escaping schemes, but these are
designed with specific input data in mind (file paths and command line
switches, for instance), which is not the case for most reported data.

\label{generalescape}
Therefore, we define a general escape function that works in a manner similar to
C's string literal escapes, but which allows arbitrary starting, termination,
and escaping characters. The input to the escape function is raw data obtained
from some data source, and the output is the same data with the following
textual replacements:

\begin{itemize}
    \item \var{EscapeCharacter} is replaced with
    \var{EscapeCharacter}\var{EscapeCharacter}.
    \item \var{RightDelimiter}, if defined,  is replaced with
    \var{EscapeCharacter}\var{RightDelimiter}.
    \item The null character (ASCII \verb|0x00|) is replaced with
    \var{EscapeCharacter}\texttt{0}.
    \item The backspace character (ASCII \verb|0x08|) is replaced with
    \var{EscapeCharacter}\texttt{b}.
    \item The form feed character (ASCII \verb|0x0C|) is replaced with
    \var{EscapeCharacter}\texttt{f}.
    \item The newline character (ASCII \verb|0x0A|) is replaced with
    \var{EscapeCharacter}\texttt{n}.
    \item The carriage return character (ASCII \verb|0x0D|) is replaced with
    \var{EscapeCharacter}\texttt{r}.
    \item The horizontal tab character (ASCII \verb|0x09|) is replaced with
    \var{EscapeCharacter}\texttt{t}.
    \item The vertical tab character (ASCII \verb|0x0B|) is replaced with
    \var{EscapeCharacter}\texttt{v}.
    \item ASCII characters which are not in the above list but are unprintable
    (that is, ASCII \verb|0x00| - \verb|0x1F|; \verb|0x7F|) are
    replaced with \var{EscapeCharacter}\texttt{xHH}, where \texttt{HH} is the
    hexadecimal representation of the numeric value of the given character.
    \item Non-ASCII characters (\verb|U+0080| and above) are replaced with
    \var{EscapeCharacter}\texttt{uHHHH}, where \texttt{HHHH} is the hexadecimal
    representation of the numeric value of the character.
    \item Unicode characters requiring a surrogate pair in UTF-16 (that is,
    greater than U+FFFF) are represented as two normal Unicode
    (\var{EscapeCharacter}\texttt{uHHHH}) escapes matching the UTF-16 surrogate
    pair. (This is exactly how they'd be represented in Windows itself.)
    \item Forum software destroys significant whitespace; but escaping every
    space would be impractical. Where there is more than a single consecutive
    space, the second and later spaces are escaped. (That is, replaced with
    ``\var{EscapeCharacter}\texttt{ }''.)
    \item Any instance of \var{EscapeCharacter} followed by an unused character
    in the above list is equivilent to that character with no escape. This will
    never be generated by the escaping functionality in Instalog for general
    escaping, but is valid for the reverse, unescaping, operation.
\end{itemize}

\subsubsection{URL Escaping Format} \label{urlescape}
URL escaping matches the general escaping format above, except has the
additional constraint of forum software which tries to convert URLs into links.
It is desireable to inhibit this behavior of the forum software, so that board
owners need not wory about linking to malicious websites. Therefore, URL
escaping is defined to be general escaping with the additional requirement that
when the string ``\texttt{http}'' (case insensitive) appears in the source, it
is replaced with ``\texttt{htt}\var{EscapeCharacter}\texttt{p}''. This inhibits
forum software's URL behavior which looks for the protocol prefix in order to
determine what portions of a post indicate a link. (Note that due to the last
reqirement of general escaping this will cause no effect on the unescaped data).

\subsection{PseudoHJT Machine Report}
The information in the PseudoHJT report MUST closely match the information
displayed by the original HJT tool. The format MUST closely match the syntax of
a similar predecessor, DDS, so that forum voulenteers need not learn
significantly different syntax to that which they know. This format MUST be
sparse and human readable. Perhaps most importantly, despite matching the
original HJT in terms of information conveyed, the format itself MUST be
different enough to avoid legal action by TrendMicro against Instalog's authors.

Generally speaking, the PseudoHJT report attempts to list all relevant loading
points on a Windows machine, as well as user settings for the Internet Explorer
browser; such as home page, search provider, and title settings. The report is
heavily whitelisted. Items which are defaults on Windows MUST NOT be emitted,
unless whitelisting has been disabled. Specific whitelisting schemes are given
per type of line shown in the PseudoHJT report.

Each line in the PseudoHJT report is given a unique prefix, which is not shared
by other line types. This allows the line to be unambiguously understood by the
Instalog GUI, and other kinds of inspection tools.

The ``Data Sources'' sections in the definitions below make use of standard
registry script, as defined by \verb|regedit.exe|, which is shipped as a
standard Windows operating system component. A full specification for this
format can be found on Wikipedia
(\url{http://en.wikipedia.org/wiki/Windows_Registry#.REG_files}) and other
similar sources.

\subsubsection{User Default Page URL}
\begin{description}
\item[Rationale] The User Default Page URL is the location(s) of pages
opened when a user creates a new Microsoft Internet Explorer window, or starts
the browser for the first time. If this value is set, it overrides the
machine-wide Default Page URL value. This setting affects 32 bit versions of
Internet Explorer only.
\item[Data Sources] \hfill
\vspace{-\baselineskip}
\begin{verbatim}
; 32 Bit Registry View
[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer]
"Default_Page_URL"="${url}"
\end{verbatim}
\item[Log Format] \hfill
\vspace{-\baselineskip}
\begin{verbatim} 
uDefaultPageUrl=${url}
\end{verbatim}
\item[Output Description] The variable \var{url} is escaped using the
URL escaping scheme defined in \ref{urlescape}, where the escape character is the
hash mark (\verb|#|). 
\item[Whitelist Considerations] The default value for this entry
differs depending on the version of Internet Explorer and Windows currently in
use. Testing will need to be undertaken against supported operating systems in
order to determine which values to hide.
\item[Fix Considerations] Valid options: fix registry. Generated script:
\vspace{-\baselineskip}
\begin{verbatim}
:reg32
[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer]
"Default_Page_URL"="about:blank"
\end{verbatim}
\end{description}

\end{document}
